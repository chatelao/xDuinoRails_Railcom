# RCN-217: RailCom - DCC Feedback Protocol

## 1. General

### 1.1 Purpose of the Standard
This standard describes the transmission of data from a decoder over the track to a receiver, in the opposite direction of the control protocols. The transmission method and protocol described here are collectively known as **RailCom**.

### 1.2 Requirements
To comply with this standard, all technical values and protocols defined herein must be observed. This specification applies exclusively to the use of RailCom within the DCC data format. The use of RailCom within other data formats is not permitted.

### 1.3 Explanations
- **Bit Meanings**:
  - `0`: Bit value 0
  - `1`: Bit value 1
  - `A`: Address bit
  - `D`: Data bit
  - `G`: Speed
  - `L`: Load
  - `P`: Location information (position)
  - `R`: Direction bit
  - `S`: Sequence number
  - `T`: Type of location information
  - `X`: Subindex
- **Bytes**: Groups of eight bits. The first bit sent (leftmost) is the **MSB** (most significant bit), and the last bit sent (rightmost) is the **LSB** (least significant bit).
- **DCC Data Packet**: A defined sequence of bits used as a track signal, as described in [RCN-210].

---

## 2. Physical Layer

### 2.1 General
The DCC system's information flow is typically from the central unit (booster) to the decoders. For reverse transmission, this flow is interrupted by a **RailCom cutout**, where boosters disconnect and short-circuit the track lines.

### 2.2 RailCom Transmitter in the Decoder
- To transmit a **'0'**, the decoder supplies a current of **30 +4/-6 mA**.
- To transmit a **'1'**, the current must not exceed **±0.1 mA**.

### 2.3 The RailCom Detector
- A current greater than **10 mA** is interpreted as **'0'**.
- A current less than **6 mA** is interpreted as **'1'**.

### 2.4 Timing
The RailCom cutout is divided into two channels:
- **Channel 1**: Transmits 2 bytes.
- **Channel 2**: Transmits up to 6 bytes.
- The transmission rate is **250 kbit/s ±2%**.

### 2.5 Data Backup
Data transmission is secured using **4-out-of-8 coding**, meaning each byte contains four '1's and four '0's.

---

## 3. Packet Layer

RailCom packets (datagrams) can have a payload of 6, 12, 18, 24, or 36 bits.
- **Channel 1**: Only a 12-bit datagram can be transmitted.
- **Channel 2**: Any combination of datagrams up to a total of 36 bits can be transmitted.

### 3.1 RailCom Command Type MOB (Mobile)
- **Channel 1**: Used by mobile decoders for rapid localization. Decoders transmit their DCC address.
- **Channel 2**: Used by the addressed decoder to transmit decoder information and acknowledgements.

### 3.2 RailCom Command Type STAT (Stationary)
- **Channel 1**: Used by accessory decoders to report service requests (SRQ).
- **Channel 2**: Used by the addressed decoder to transmit decoder information and acknowledgements.

---

## 4. RailCom CVs and DCC Commands

### 4.1 System Requirements
This specification is designed to be backward compatible. Decoders that are not RailCom-capable can still be operated, and command stations that are not RailCom-capable can still control RailCom-capable decoders.

### 4.2 CVs
- **CV28 (RailCom Configuration)**:
  - Bit 0: Channel 1 for address broadcast (1=enabled, 0=disabled).
  - Bit 1: Channel 2 for data and acknowledge (1=enabled, 0=disabled).
- **CV31, CV32**: Used as pointers.
- **RailCom Block**: CV31=0 and CV32=255 address a block of 256 CVs for RailCom applications.

### 4.3 DCC Commands
- **Additional Function Commands**: Used for search functions, rerail search, etc.
- **Advanced Programming Commands**: For programming CVs in operating mode.
- **NOP for Accessory Decoders**: Allows accessory decoders to send an SRQ.

---

## 5. Applications for Vehicle Decoders

### 5.1 POM (ID 0)
Programming on the Main (POM) for reading and writing CVs in operating mode.

### 5.2 ADR (IDs 1 & 2)
Vehicle decoders broadcast their active address on Channel 1.

### 5.3 EXT (ID 3)
Transmits location information.

### 5.4 Current Travel Information (ID 4)
Transmits dynamic information from vehicle decoders.

### 5.5 DYN (ID 7)
Transmits dynamic variables (DVs) such as speed and container levels.

### 5.6 XPOM (ID 8 to ID 11)
Extended format for writing and reading up to four CVs in operating mode.

### 5.7 CV-Car (ID 12)
Transmits CVs from vehicle decoders in the background.

---

## 6. Applications for Accessory Decoders

### 6.1 SRQ - Service Request
Accessory decoders use Channel 1 to request communication from the central unit.

### 6.2 POM (ID 0)
Programming on the Main for accessory decoders.

### 6.3 STAT1 (ID 4)
Transmits status messages.

### 6.4 STAT4 (ID 3)
Transmits the status of all four output pairs of simple accessory decoders.

### 6.5 TIME (ID 5)
Transmits the forecasted orbital time of the decoder.

### 6.6 ERROR (ID 6)
Transmits error information.

### 6.7 DYN (ID 7)
Transmits dynamic information.

### 6.8 XPOM (ID 8 to ID 11)
Extended Programming on the Main for accessory decoders.

### 6.9 STAT2 (ID 8)
Transmits status messages, specially tailored for mechanical control operations.
