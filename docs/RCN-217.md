# RCN-217: RailCom DCC-Rückmeldeprotokoll

**Ausgabe: 27.07.2025**

---

## Inhalt

- [1 Allgemeines](#1-allgemeines)
  - [1.1 Zweck der Norm](#11-zweck-der-norm)
  - [1.2 Anforderungen](#12-anforderungen)
  - [1.3 Erläuterungen](#13-erläuterungen)
- [2 Physical Layer](#2-physical-layer)
  - [2.1 Allgemeines](#21-allgemeines)
  - [2.2 RailCom – Sender im Decoder](#22-railcom--sender-im-decoder)
  - [2.3 Der RailCom Detector](#23-der-railcom-detector)
  - [2.4 Timing](#24-timing)
  - [2.5 Datensicherung](#25-datensicherung)
- [3 Packet Layer](#3-packet-layer)
  - [3.1 RailCom Befehlsart MOB](#31-railcom-befehlsart-mob)
  - [3.2 RailCom Befehlsart STAT](#32-railcom-befehlsart-stat)
- [4 RailCom CVs und DCC-Befehle](#4-railcom-cvs-und-dcc-befehle)
  - [4.1 Systemanforderungen](#41-systemanforderungen)
  - [4.2 CVs](#42-cvs)
    - [4.2.1 CV28 RailCom Konfiguration](#421-cv28-railcom-konfiguration)
    - [4.2.2 CV29](#422-cv29)
    - [4.2.3 CV31, CV32](#423-cv31-cv32)
    - [4.2.4 RailCom Block](#424-railcom-block)
  - [4.3 DCC-Befehle](#43-dcc-befehle)
    - [4.3.1 Zusätzliche Funktionskommandos](#431-zusätzliche-funktionskommandos)
    - [4.3.2 Erweiterte Programmierbefehle](#432-erweiterte-programmierbefehle)
    - [4.3.3 NOP für Zubehördecoder](#433-nop-für-zubehördecoder)
- [5 Anwendungen (Application/APP) Layer für Fahrzeugdecoder](#5-anwendungen-applicationapp-layer-für-fahrzeugdecoder)
  - [5.1 POM (ID 0)](#51-pom-id-0)
    - [5.1.1 Byte Lesen](#511-byte-lesen)
    - [5.1.2 Byte Schreiben](#512-byte-schreiben)
    - [5.1.3 Bit Schreiben](#513-bit-schreiben)
  - [5.2 ADR (IDs 1 & 2)](#52-adr-ids-1--2)
    - [5.2.1 Dynamische Kanal-1-Nutzung](#521-dynamische-kanal-1-nutzung)
    - [5.2.2 Info 1 (ID 3)](#522-info1-id-3)
    - [5.2.3 Aufgleissuche (ID 1, 2 und 14)](#523-aufgleissuche-id-1-2-und-14)
    - [5.2.4 Decoderanmeldung über die Programmieradresse 0000](#524-decoderanmeldung-über-die-programmieradresse-0000)
  - [5.3 EXT (ID 3)](#53-ext-id-3)
    - [5.3.1 Senden der Ortsinformation](#531-senden-der-ortsinformation)
    - [5.3.2 Befüllen](#532-befüllen)
  - [5.4 Aktuelle Fahrinformation (ID 4)](#54-aktuelle-fahrinformation-id-4)
  - [5.5 DYN (ID 7)](#55-dyn-id-7)
  - [5.6 XPOM (ID 8 bis ID 11)](#56-xpom-id-8-bis-id-11)
    - [5.6.1 XPOM Byte Lesen](#561-xpom-byte-lesen)
    - [5.6.2 Byte Schreiben](#562-byte-schreiben)
    - [5.6.3 Bit Schreiben](#563-bit-schreiben)
  - [5.7 CV-Auto (ID 12)](#57-cv-auto-id-12)
- [6 Anwendung für Zubehördecoder (Weichen etc.)](#6-anwendung-für-zubehördecoder-weichen-etc)
  - [6.1 SRQ - Service Request für Zubehördecoder](#61-srq---service-request-für-zubehördecoder)
  - [6.2 POM (ID 0)](#62-pom-id-0)
    - [6.2.1 Byte Lesen](#621-byte-lesen)
    - [6.2.2 Byte Schreiben](#622-byte-schreiben)
    - [6.2.3 Bit Schreiben](#623-bit-schreiben)
  - [6.3 STAT1 (ID 4)](#63-stat1-id-4)
  - [6.4 STAT4 (ID 3)](#64-stat4-id-3)
  - [6.5 ZEIT (ID 5)](#65-zeit-id-5)
  - [6.6 FEHLER (ID 6)](#66-fehler-id-6)
  - [6.7 DYN (ID 7)](#67-dyn-id-7)
  - [6.8 XPOM (ID 8 bis ID 11)](#68-xpom-id-8-bis-id-11)
    - [6.8.1 XPOM Byte Lesen](#681-xpom-byte-lesen)
    - [6.8.2 Byte Schreiben](#682-byte-schreiben)
    - [6.8.3 Bit Schreiben](#683-bit-schreiben)
  - [6.9 STAT2 (ID 8)](#69-stat2-id-8)
- [Anhang A: Verweise auf andere Normen](#anhang-a-verweise-auf-andere-normen)
  - [A.1 Normative Verweise](#a1-normative-verweise)
  - [A.2 Informative Verweise](#a2-informative-verweise)
- [Anhang B: Historie](#anhang-b-historie)

---

## 1 Allgemeines

### 1.1 Zweck der Norm

Diese Norm beschreibt die Übertragung von Daten vom Decoder über das Gleis zu einem Empfänger, d.h. in der Gegenrichtung zu den Steuerungsprotokollen. Die hier beschriebene Übertragungsmethode zusammen mit dem verwendeten Protokoll trägt die Bezeichnung RailCom.

"RailCom" ist eine auf den Namen von Lenz Elektronik für die Klasse 9 "Elektronische Steuerungen" unter der Nummer 301 16 303 eingetragene Deutsche Marke sowie ein für die Klassen 21, 23, 26, 36 und 38 "Electronic Controls for Model Railways" in U.S.A. unter Reg. Nr. 2,746,080 eingetragene Trademark. Das Europäische Patent 1 380 326 B1 wurde aufgehoben. Damit ist RailCom unter Beachtung der Warenzeichen frei verwendbar.

Diese Spezifikation gilt ausschließlich für die Anwendung von RailCom innerhalb des DCC-Datenformats (Protokolls). Die Anwendung von RailCom innerhalb anderer Datenformate ist nicht zugelassen.

### 1.2 Anforderungen

Um diese Norm zu erfüllen, müssen alle in dieser Norm definierten technischen Werte und Protokolle eingehalten werden. Die Tabellen 5 bis 7 definieren, welche der Meldungen von einem Decoder mindestens zu unterstützen sind.

### 1.3 Erläuterungen

- Ein DCC-Datenpaket ist eine definierte Folge von Bits, die als Gleissignal in [RCN-210] beschrieben sind.
- Als Bytes werden Bitgruppen aus je acht Bits bezeichnet.
- Jedes Bit im Byte hat eine von seiner Position abhängende Wertigkeit, das erste gesendete, in der Darstellung linke Bit, hat die höchste Wertigkeit und heißt MSB "most significant bit". Die Bits eines Bytes werden von links mit 7 beginnend nach rechts fallend bis 0 nummeriert. Das zuletzt gesendete, in der Darstellung rechte Bit, heißt LSB "least significant bit".
- „XF#“ bezeichnet die Binärzustandssteuerungsbefehle nach [RCN-212] Abschnitt 2.3.5.
- Folgende Zeichen werden zur Kennzeichnung der Bedeutung eines Bits verwendet:
  - `0` Bitwert 0
  - `1` Bitwert 1
  - `A` Adressbit
  - `D` Datenbit
  - `G` Geschwindigkeit
  - `L` Last
  - `P` Ortsinformation (Position)
  - `R` Richtungsbit
  - `S` Sequenznummer
  - `T` Typ der Ortsinformation
  - `X` Subindex

Die in den DCC-Befehlen verwendeten Zeichen sind hier nicht nochmals aufgeführt.

Die in dieser Norm in den Kästen darstellten Bitkombinationen für DCC sind rein informativ und haben keinen normativen Charakter. Hier gelten ausschließlich die angegeben RCNs.

Die Befehle von der Zentrale zum Decoder (►) sind jeweils ohne die Adressierungs-Daten notiert. Die Adressierung erfolgt nach dem DCC-Standard.

(◄) kennzeichnet die vom Decoder zur Zentrale gesendeten RailCom-Daten.

Wenn nicht anders angegeben, beziehen sich Werte immer auf ein 8-Bit-Feld. Binäre Werte sind entsprechend der Liste oben gekennzeichnet. Hexadezimale Werte sind durch ein vorangestelltes `0x` gekennzeichnet.

---

## 2 Physical Layer

Dieses Kapitel beschreibt die physikalische Schicht von RailCom.

### 2.1 Allgemeines

Der Informationsfluss im DCC-System erfolgt normalerweise von der Zentrale (Booster) über das Gleis zu den Decodern. Für die umgekehrte Übertragungsrichtung ist es erforderlich, diesen Energie- und Datenstrom zu unterbrechen. Dies geschieht durch die Booster, die dazu am Ende eines jeden DCC-Paketes ein sogenanntes RailCom-Cutout erzeugen, indem sie die beiden Track (Gleis)-Leitungen von der Spannungsversorgung trennen und kurzschließen. Diese Funktionsgruppe innerhalb des Boosters wird "Cutout Device" genannt. Ein solches Cutout Device könnte auch als separate Einheit außerhalb des Boosters ausgeführt werden. Die eigentliche Datenübertragung erfolgt mittels einer Stromschleife. Den dazu notwendigen Strom muss der Decoder aus seinem internen Puffer bereitstellen. Abbildung 1 zeigt die Anordnung von Booster, Detector und Decoder während des RailCom-Cutout.

*Bild 1: RailCom Prinzipschaltbild*

Der Spannungsabfall über dem Cutout Device darf 10mV bei maximal 34 mA während des Cutout nicht übersteigen.

### 2.2 RailCom – Sender im Decoder

Um eine '0' zu übertragen, muss der Decoder einen Strom I von 30+4/-6 mA liefern, bei einem Spannungsabfall am Gleis von bis zu 2.2 V. Ist Hochstrom-RailCom in CV28 freigegeben, beträgt der Strom 60 +8/-12 mA, ebenfalls bei einem Spannungsabfall am Gleis von bis zu 2.2 V. Bei einer '1' darf der Strom I höchstens ± 0.1 mA betragen. Die Stromquelle des Decoders muss gegen unerwartete Fremdspannung am Gleis während des Cutout geschützt sein. Abbildung 2 zeigt eine mögliche Hardware-Realisierung.

*Bild 2: Symbolische Darstellung der RailCom Decoder Hardware*

**Erläuterung zum Schaltbild:**
Der RailCom-Teil besteht nur aus den Widerständen R1 bis R3 und den Transistoren T1A bis T2B. T1A und T1B bilden eine Stromquelle, T2A ist als Diode geschaltet und schützt die Stromquelle vor positiven Spannungen höher Vcc. Alle anderen Teile der Schaltung gehören zur normal notwendigen Hardware des Decoders. Man beachte den äußerst geringen Hardwareaufwand für den RailCom-Sender.

Es wird empfohlen, dass die Einspeisung so erfolgt, dass der positive Pol an der in Fahrtrichtung vorwärts rechten Schiene liegt. Damit kann die Richtung des Fahrzeugs auf dem Gleis erkannt werden. Allerdings gibt es Situationen, in denen diese Empfehlung nicht eingehalten werden kann. Daher wurde die ID 3 im Kanal 1 ergänzt (Abschnitt 5.2.2).

Die Richtungserkennung funktioniert Prinzip bedingt nur im Zweischienen-Zweileiter-System. Im Dreischienen-Zweileiter-System ("Märklin") und im Dreischienen-Dreileiter-System ("Trix-Express") kann die Aufgleisrichtung nicht über die Polarität des RailCom- oder Gleissignals erkannt werden. Also weder durch die Empfehlung hier noch über die ID 3 im Kanal 1.

### 2.3 Der RailCom Detector

Ein Detector muss einen Strom von größer 10mA während der mittleren 50% der Bitzeit als '0' interpretieren, einen Strom von kleiner 6 mA während der mittleren 50% der Bitzeit als '1'. Der Spannungsabfall über dem Detector darf 200mV bei maximal 34 mA während des Cutout nicht übersteigen. Abbildung 3 zeigt eine mögliche Hardware Realisierung.

*Bild 3: Beispiel einer simplen RailCom Detector Hardware*

Es dürfen maximal zwei Detectoren (inkl. des globalen Detectors) in Reihe verwendet werden, wobei der lokale Detector einen Anschluss für externe Auswertung einer Gleisbelegung enthalten sollte. Ist dies nicht der Fall, müssen extern verwendete Belegtmelder für RailCom spezifiziert sein.

**Erläuterung:**
Getestet wurden diese Schaltungen (Sender und Detector) auf großen Clubanlagen bis zu einer Entfernung von 100m. Diese Entfernung wurde problemlos überbrückt. Zugelassen sind dabei nicht vom Gleis durch Brückengleichrichter isolierte Verbraucher von 5 Ohm, die parallel zum Messwiderstand des Detectors liegen. Der Wert von 5 Ohm entspricht bei einer Gleisspannung von 15V einem Strom von 3A. Glühlampen (Kaltleiter) sind immer über einen schnellen Brückengleichrichter (< 500 ns) zu betreiben.

### 2.4 Timing

In einem Cutout können bis zu 8 Byte Daten übertragen werden. Jedes übertragene Byte beginnt mit einem Startbit ('0') gefolgt von den 8 Datenbits (niederwertigstes Bit zuerst) und endet mit einem Stoppbit ('1'). Die Übertragungsrate ist 250 kbit/s ±2%. Die Anstiegszeit (10% → 90%) und Abfallzeit (90% → 10%) darf 0,5 µs nicht überschreiten.

Das RailCom Cutout ist in zwei Kanäle unterteilt. Im Kanal 1 können 2 Bytes, im Kanal 2 bis zu 6 Bytes übertragen werden. Abbildung 4 zeigt das Timing Diagramm. Sämtliche Zeiten sind auf den Null-Durchgang der letzten Flanke des Paket-Endebits bezogen.

*Bild 4: RailCom Timing*

| Parameter     | Name | Min   | Max   |
|---------------|------|-------|-------|
| Cutout Start  | TCS  | 26µs  | 32µs  |
| Cutout End    | TCE  | 454µs | 488µs |
| Start Kanal 1 | TTS1 | 80µs \*) | |
| End Kanal 1   | TTC1 |       | 177µs |
| Start Kanal 2 | TTS2 | 193µs |       |
| End Kanal 2   | TTC2 |       | 454µs |

**Tabelle 1: Timing Parameter**

\*) Detector sollte schon bei 75 µs für den Kanal 1 empfangsbereit sein.

**Bemerkung:**
Obige Abbildung zeigt das RailCom Timing mit "1"-Bits von 2*58µs (Nominalwert des DCC "1"-Bit). Bei kürzeren "1"-Bits ist es möglich, dass das Cutout ins 5. "1"-Bit hineinreicht. Dies ist aber kein Problem, da eine Zentrale entsprechend [RCN-211] mindestens 4 + 12 = 16 Synchronbits senden muss (Paket-Endebit des vorherigen DCC-Pakets nicht mitgezählt), der Decoder also ausreichend Synchronbits (mindestens 12 Synchronbits müssen gesendet werden, 10 sind für eine Erkennung des Paketes durch den Decoder erforderlich) sieht.

Eine Cutout Zeit von ca. 450µs darf die Funktion eines Decoders, der RailCom nicht beherrscht, nicht beeinflussen, da auf einer realen Modellbahnanlage Stromunterbrechungen bis 20ms nachgewiesen wurden, d.h. ein Decoder sollte mindestens eine Stromunterbrechung in dieser Größenordnung verarbeiten können.

### 2.5 Datensicherung

Die Sicherung der Datenübertragung erfolgt via 4 aus 8 Codierung, d.h. jedes übertragene Byte enthält 4 '1'- und 4 '0'-Bits (Hamming-Gewicht 4). Ist dieses Verhältnis verletzt, liegt ein Übertragungsfehler vor.

Es gibt 70 verschiedene Bitkombinationen innerhalb eines Bytes, die ein Hamming-Gewicht von 4 aufweisen. Davon werden 64 für die Übertragung von 6 Nutzbits verwendet, von den 6 übrigen werden drei für kurze Sondermitteilungen genutzt, 2 x ACK und NACK. Die restlichen drei Kombinationen werden im Moment nicht benutzt.

Es lassen sich in Kanal 1 netto 12 Bit, in Kanal 2 netto bis zu 36 Bit Nutzdaten übertragen.

Die möglichen Codierungen:

| Wert | Code     | Wert | Code     | Wert | Code     | Wert | Code     |
|------|----------|------|----------|------|----------|------|----------|
| 0x00 | 10101100 | 0x10 | 10110010 | 0x20 | 01010110 | 0x30 | 11000110 |
| 0x01 | 10101010 | 0x11 | 10110100 | 0x21 | 01001110 | 0x31 | 11001100 |
| 0x02 | 10101001 | 0x12 | 10111000 | 0x22 | 01001101 | 0x32 | 01111000 |
| 0x03 | 10100101 | 0x13 | 01110100 | 0x23 | 01001011 | 0x33 | 00010111 |
| 0x04 | 10100011 | 0x14 | 01110010 | 0x24 | 01000111 | 0x34 | 00011011 |
| 0x05 | 10100110 | 0x15 | 01101100 | 0x25 | 01110001 | 0x35 | 00011101 |
| 0x06 | 10011100 | 0x16 | 01101010 | 0x26 | 11101000 | 0x36 | 00011110 |
| 0x07 | 10011010 | 0x17 | 01101001 | 0x27 | 11100100 | 0x37 | 00101110 |
| 0x08 | 10011001 | 0x18 | 01100101 | 0x28 | 11100010 | 0x38 | 00110110 |
| 0x09 | 10010101 | 0x19 | 01100011 | 0x29 | 11010001 | 0x39 | 00111010 |
| 0x0A | 10010011 | 0x1A | 01100110 | 0x2A | 11001001 | 0x3A | 00100111 |
| 0x0B | 10010110 | 0x1B | 01011100 | 0x2B | 11000101 | 0x3B | 00101011 |
| 0x0C | 10001110 | 0x1C | 01011010 | 0x2C | 11011000 | 0x3C | 00101101 |
| 0x0D | 10001101 | 0x1D | 01011001 | 0x2D | 11010100 | 0x3D | 00110101 |
| 0x0E | 10001011 | 0x1E | 01010101 | 0x2E | 11010010 | 0x3E | 00111001 |
| 0x0F | 10110001 | 0x1F | 01010011 | 0x2F | 11001010 | 0x3F | 00110011 |

- **ACK** `00001111` "Befehl ist verstanden und wird ausgeführt werden" oder "JA"
- **ACK** `11110000` "Befehl ist verstanden und wird ausgeführt werden" oder "JA"
- **reserviert** `11100001`
- **reserviert** `11000011`
- **reserviert** `10000111`
- **NACK** `00111100` "Befehl bzw. CV wird nicht unterstützt“ – optional

**Tabelle 2: Codierungen im 4 aus 8 Code**

**Erläuterung zu NACK:**
Diese optionale Antwort kann einen Befehl kennzeichnen, der nicht unterstützt wird. Dabei ist die Erkennung eines nicht unterstützten Befehls ausschließlich auf das erste Befehlsbyte bezogen. Bei POM kann (unabhängig von der Antwort auf nicht implementierte Befehle) ein NACK auch gesendet werden, um eine nicht existierende CV zu kennzeichnen. Damit nicht fälschlich der POM-Befehl als nicht unterstützt gewertet wird, darf ein NACK nicht als erste Antwort auf einen POM-Befehl gesendet werden. D.h. beim Zugriff auf eine nicht existierende CV wird erst mit einem ACK und dann mit einem NACK geantwortet. ACK und NACK können gemeinsam im gleichen Kanal 2 gesendet werden.

---

## 3 Packet Layer

Dieses Kapitel beschreibt den Aufbau von RailCom-Paketen.

RailCom Pakete (im Folgenden mit Datagramm bezeichnet) haben eine Länge von 6, 12, 18, 24 oder 36 Nutz-Bits. In Kanal 1 kann nur ein 12 Bit Datagramm übertragen werden. In Kanal 2 können beliebige Kombinationen von Datagrammen mit einer maximalen Gesamtlänge von 36 Bit übertragen werden.

Optional kann der Datenkanal mit ACK auf 36 Bit aufgefüllt werden.

Datagramme (außer ACK und NACK) beginnen, wenn nicht anders erläutert, mit einem 4 Bit Identifier, gefolgt von 8, 14, 20 oder 32 Bit Nutzdaten, die wie folgt übertragen werden:

| Datagramm | Bytes                                                       |
|-----------|-------------------------------------------------------------|
| 12 Bit    | ID[3-0]D[7-6]+D[5-0]                                        |
| 18 Bit    | ID[3-0]D[13-12]+D[11-6]+D[5-0]                              |
| 24 Bit    | ID[3-0]D[19-18]+D[17-12]+D[11-6] +D[5-0]                    |
| 36 Bit    | ID[3-0]D[31-30]+D[29-24]+D[23-18]+D[17-12]+D[11-6] +D[5-0] |

**Tabelle 3: Datagramm-Aufbau**

Die Länge des Datagramms ist durch den Identifier (siehe Kapitel 3.1 und 3.2) bestimmt.

Für die automatische Anmeldung von Decodern können die beiden Datenkanäle zusammengefasst werden (Kanalbündelung). Dabei bleibt das Timing der beiden Kanäle unverändert, es wird aber nur ein Datenblock mit insgesamt 48 Bit – kontextabhängig einschließlich eines Identifiers – gesendet. Der Aufbau dieses Datenblocks ist in [RCN-218] definiert.

Mobile Decoder (Fahrzeugdecoder) und stationäre Decoder (Zubehördecoder) haben unterschiedliche Rückmeldeanforderungen. Entsprechend werden die Kanäle für beide Decodertypen unterschiedlich genutzt. Die Bedeutung der Datagramme ist somit abhängig von der Adresse des vorangestellten DCC Pakets. Entsprechend werden die folgenden RailCom-Befehlsarten MOB (mobil) und STAT (stationär) anhand der DCC-Adressbereiche wie in [RCN-211] Abschnitt 3 definiert unterschieden:

| DCC Adresse 1. Byte | DCC Adresse 2. Byte | Daten in Kanal 1 | DCC bzw. RailCom Befehlsart                                                                                   |
|-----------------------|-----------------------|------------------|---------------------------------------------------------------------------------------------------------------|
| 0                     | keine                 |                  | Fahrzeugdecoder Broadcast                                                                                     |
| 1-127                 |                       | ID 1, ID 2       | MOB (Fahrzeugdecoder) Kurze Adresse                                                                           |
| 128-191               |                       | SRQ              | STAT (Zubehördecoder) – kein Identifier!                                                                      |
| 192-231               | ADR low               | ID 1, ID 2       | MOB (Fahrzeugdecoder) Lange Adresse. Die lange Adresse 0 wird auch als Programmieradresse verwendet. (Abschnitt 5.2.4) |
| 232-252               | keine                 |                  | Reserviert                                                                                                    |
| 253                   | keine                 |                  | Verwendet für Datenübertragung nach NMRA-Festlegung in [S-9.2.1.1]. Die Adressierung erfolgt über die DCC-Adresse in einem gepackten Format. |
| 254                   |                       | Kanal-bündelung  | Verwendet für automatische Anmeldung nach [RCN-218] – Identifier kontextabhängig! Bei adressierten Befehlen Adressierung über Unique ID. |
| 255                   |                       | ID 14, ID 15 bei RailCom-Plus® | 255 ist die Adresse des Leerlauf-Paketes (0xFF - 0x00 - 0xFF). Ein erstes Datenbyte ungleich 0 kennzeichnet die Verwendung im Rahmen von RailComPlus®. In jedem Fall besteht das Paket dann aus mehr als 3 Bytes. |

**Tabelle 4: DCC-Adressbereiche für Befehlsarten**

Auf das Leerlauf-Paket sowie auf Service Mode Pakete dürfen Decoder keine Rückmeldung senden. Im Kanal 2 darf nur der vom DCC-Paket adressierte Decoder senden. Um Rückmeldungen im Kanal 1 zu ermöglichen, solange noch keine DCC-Lokadresse angesprochen wird, wird empfohlen alternierend zum Idle-Paket die DCC-Lokadresse 10239 anzusprechen.

Nach einem Befehl an die Adresse 254 entweder zur automatischen Anmeldung mit DCC-A nach [RCN-218] oder entsprechend [S-9.2.1.1] werden die Kanäle 1 und 2 gebündelt und es werden kontextabhängig Identifier verwendet. Die Rückmeldungen nach Befehlen an die Adressen 253 und 255 sind in der Norm [S-9.2.1.1] der NMRA bzw. der RailComPlus®-Spezifikation festgelegt.

### 3.1 RailCom Befehlsart MOB

Kanal 1 nutzen mobile Fahrzeugdecoder zur schnellen Lokalisierung auf der Anlage (siehe app:adr). Dazu müssen sie nach jedem an einen Fahrzeugdecoder gerichteten DCC Paket (Kennzeichnung MOB in Tabelle 4) ihre DCC-Adresse senden, die dann von lokalen Detectoren auf der Anlage empfangen wird. Ausgenommen sind die Programmiermodus-Pakete von dem Zeitpunkt an, zu dem der Decoder den Programmiermodus erkennt. Die Aussendung nach jedem an einen Fahrzeugdecoder gerichteten DCC Paket (kurze Adresse 1..127, lange Adresse 1...10239) ist erforderlich, damit bei mehreren Sendern im Abschnitt nicht Teile verschiedener Adressen fälschlich zu einer falschen, nicht vorhandenen Adresse zusammengesetzt werden.

Kanal 2 darf nur vom adressierten Decoder benutzt werden und dient zur Übermittlung von Decoderinformationen. Ein adressierter Decoder muss stets eine Rückmeldung in Kanal 2 senden (gegebenenfalls ACK), um den fehlerfreien Empfang des DCC-Pakets zu bestätigen. Eine Rückmeldung im Kanal 2 signalisiert, dass der Decoder den Befehl fehlerfrei empfangen hat, nicht jedoch, dass der Befehl vom Decoder auch akzeptiert und ausgeführt wird.

Die folgenden Identifier (Datagramme) sind für Fahrzeugdecoder definiert, wobei alle nicht aufgeführten IDs als reserviert zu betrachten sind.

| ID | Kanal 1 | Bemerkung |
|----|---------|-----------|
| 1  | app:adr_high | zwingend |
| 2  | app:adr_low | Zwingend |
| 3  | app:info1 | optional, über CV 28 Bit 3 freigegeben. |
| 14 | RailComPlus | Nicht mehr für die RailCommunity verfügbar. |
| 15 | RailComPlus | Nicht mehr für die RailCommunity verfügbar. |

**Tabelle 5: Befehlsart MOB Identifier (Datagramme) im Kanal 1**

| ID | Kanal 2 | Länge | Bemerkung | Befehlsbezogen |
|----|---------|-------|-----------|----------------|
| 0  | app:pom | 12 Bit | Zwingend, 1 Byte | ja, POM RCN-214 |
| 1  | app:adr_high | 12 Bit | optional zur Aufgleissuche | ja, Aufgleissuche XF2 |
| 2  | app:adr_low | 12 Bit | optional zur Aufgleissuche | ja, Aufgleissuche XF2 |
| 3  | app:ext | 18 Bit | optional | ja, Ortsinformation XF1 |
| 4  | app:info | 36 Bit | reserviert für Aktuelle Fahrinformationen | nein |
| 7  | app:dyn | 18 Bit (ggf. 2 Mal) | optional | nein¹ |
| 8  | app:xpom | 36 Bit | optional | ja, XPOM RCN-214 |
| 9  | app:xpom | 36 Bit | optional | ja, XPOM RCN-214 |
| 10 | app:xpom | 36 Bit | optional | ja, XPOM RCN-214 |
| 11 | app:xpom | 36 Bit | optional | ja, XPOM RCN-214 |
| 12 | app:CV-auto | 36 Bit | Automatische Übertragung von CVs | nein |
| 13 | app:block | 36 Bit | optional siehe [TN-217] | nein |
| 14 | app:zeit | 12 Bit | optional zur Aufgleissuche | ja, Aufgleissuche XF2 |

**Tabelle 6: Befehlsart MOB Identifier (Datagramme) im Kanal 2**

¹ Bisher ist noch kein Befehl zur Anforderung einer bestimmten DV festgelegt worden. Dieses ist aber zur Einsparung von IDs durchaus möglich und kann in Zukunft erfolgen.

- **"zwingend"**: bedeutet vollständige Implementierung
- **"optional"**: entweder vollständige Implementierung oder: teilweise Implementierung mit den unter 4.1 genannten Bedingungen
- **"Befehlsbezogen"**: bei "ja" dürfen die Meldungen in Kanal 2 nur auf einen entsprechenden Befehl folgen; bei "nein" nach einem beliebigen Befehl an den Decoder. Diese nicht befehlsbezogenen Antworten werden auch als ACK gewertet.

**Bemerkung:**
Ältere Decoder haben während einer Testphase verschiedene Identifier belegt, die jetzt als "reserviert" gekennzeichnet sind. Neuere Decoder müssen in einer speziellen CV (siehe Abschnitt "RailCom CVs") die RailCom-Versionsnummer eingetragen haben. Dies kann zur Unterscheidung benutzt werden. Ältere Decoder ohne Versionsnummer sollte man updaten (lassen).

Werden im Kanal 2 mehrere Datagramme gesendet, so sind diese in folgender Reihenfolge der IDs zu senden: 1 2 0 3 4 7 8 9 10 11 13 14 5 6 15 12. Dieses ist die Reihenfolge in der die IDs festgelegt wurden. Dieses erlaubt älteren Detektoren die ihnen bekannten Datagramme auszuwerten. Folgt ein älteres Datagramm auf ein neueres, kann ein älterer Detektor kein Datagramm auswerten, da er nicht die Länge des ersten, neueren Datagramms kennt. Ein ACK oder NACK darf nicht führend sein, da nach einem ACK bzw. NACK alle Daten ignoriert werden dürfen.

### 3.2 RailCom Befehlsart STAT

Zubehördecoder nutzen Kanal 1 zur Meldung von Service Request Anforderungen (siehe app:srq). Dazu können sie nach jedem an einen Zubehördecoder gerichteten DCC Paket (Kennzeichnung STAT in Tabelle 4) ihre Identität (12-Bit Adresse) senden (12 Bit Wert ohne Identifier!) (Nicht bei Adressierung via Decoder ID). Melden sich mehrere Decoder gleichzeitig, muss eine Suche gestartet werden.

Die Service Request Anforderungen sind optional.

Kanal 2 darf nur vom adressierten Decoder benutzt werden und dient zur Übermittlung von Decoderinformationen. Ein adressierter Decoder muss stets eine Rückmeldung in Kanal 2 senden (gegebenenfalls ACK), um den fehlerfreien Empfang des DCC-Pakets zu bestätigen.

Eine Rückmeldung im Kanal 2 signalisiert, dass der Decoder den Befehl fehlerfrei empfangen hat, nicht jedoch, dass der Befehl vom Decoder auch akzeptiert und ausgeführt wird.

Die folgenden Identifier (Datagramme) in Kanal 2 sind für Zubehördecoder definiert, wobei alle nicht aufgeführten IDs als reserviert zu betrachten sind:

| ID | Kanal 2 | Länge | Bemerkung | Befehlsbezogen |
|----|---------|-------|-----------|----------------|
| 0  | app:pom | 12 Bit | optional | ja, POM RCN-214 |
| 3  | app:stat4 | 36 Bit | optional | nein |
| 4  | app:stat1 | 12 Bit | zwingend | nein |
| 5  | app:zeit | 12 Bit | optional | nein |
| 6  | app:fehler | 12 Bit | zwingend | nein |
| 7  | app:dyn | 18 Bit (ggf. 2 Mal) | optional | nein² |
| 8  | app:xpom (alt: stat2) | 36 Bit | optional | nein |
| 9  | app:xpom | 36 Bit | optional | nein |
| 10 | app:xpom | 36 Bit | optional | nein |
| 11 | app:xpom | 36 Bit | optional | nein |
| 12 | app: Test Feature ID | variabel | optional | n/a |
| 13 | app:block | 36 Bit | optional | (noch nicht definiert) |

**Tabelle 7: Befehlsart STAT Identifier (Datagramme) im Kanal 2**

- **"zwingend"**: bedeutet vollständige Implementierung
- **"optional"**: entweder vollständige Implementierung oder teilweise Implementierung mit den unter 4.1 genannten Bedingungen
- **"Befehlsbezogen"**: bei "ja" dürfen die Meldungen in Kanal 2 nur auf einen entsprechenden Befehl folgen; bei "nein" nach einem beliebigen Befehl an den Decoder. Diese nicht befehlsbezogenen Antworten werden auch als ACK gewertet.

---

## 4 RailCom CVs und DCC-Befehle

### 4.1 Systemanforderungen

Diese RailCom Spezifikation ist so aufgebaut, dass sie rückwärtskompatibel ist, d.h. nicht RailCom-fähige Decoder können weiter betrieben werden und nicht RailCom-fähige Zentralen können weiter RailCom-fähige Decoder ansteuern.

Das Ansteuern analoger Fahrzeuge (Lokomotiven ohne Decoder) mit Hilfe der verlängerten "0" (stretched zero) ist nicht zugelassen.

Decoder mit RailCom Implementierung müssen folgende Antworten zwingend unterstützen: ACK, Fahrzeugdecoder zusätzlich app:adr_high und app:adr_low im Kanal 1 und app:pom im Kanal 2, Zubehördecoder zusätzlich app:stat1 und app:fehler.

Auf jede Fahrzeug- bzw. Weichen- Adressierung muss der Decoder im Kanal 2 der Austastlücke antworten (siehe Applikationen). Der Decoder darf keinesfalls antworten, wenn er nicht adressiert wurde oder der Befehl an die Broadcast-Adresse 0 gesendet wurde.

### 4.2 CVs

Alle hier dargestellten CVs sind nur zur Information dargestellt. Bindend ist die Festlegung in [RCN-225].

#### 4.2.1 CV28 RailCom Konfiguration

| Bit | Funktion | Wert |
|-----|----------|------|
| 0   | Kanal 1 für Adress-Broadcast (Abschnitt 5.2) | 1 = freigegeben, 0 = gesperrt |
| 1   | Kanal 2 für Daten und Acknowledge | 1 = freigegeben, 0 = gesperrt |
| 2   | Kanal 1 automatisch abschalten (Abschnitt 5.2.1) | 1 = freigegeben, 0 = gesperrt |
| 3   | Senden von ID 3 in Kanal 1 (Abschnitt 5.2.2) | 1 = freigegeben, 0 = gesperrt |
| 4   | Programmieradresse 0000 (lange Adresse 0) (Abschnitt 5.2.4) | 1 = freigegeben, 0 = gesperrt |
| 5   | reserviert | |
| 6   | Freigabe Hochstrom-RailCom (Abschnitt 2.2) | 1 = freigegeben, 0 = gesperrt |
| 7   | Freigabe automatische Anmeldung | 1 = freigegeben, 0 = gesperrt |

**Tabelle 8 RailCom Konfiguration**

Die Bits 0, 2 und 3 gelten nur für Fahrzeugdecoder und nicht für Zubehördecoder.

Um zum bisherigen Verhalten kompatibel zu sein, sollte CV28 Bit 2 bei Auslieferung eines Decoders auf 0 sein. Bei Auslieferung eines Decoders sollte der Wert von Bit 0 bei Fahrzeugdecodern 1 und bei Zubehördecodern 0 sein und der Wert von Bit 1 bei allen Decodern 1 sein. Für die automatische Anmeldung über Adresse 254 entsprechend [RCN-218] ist Kanal 1 immer freigegeben.

#### 4.2.2 CV29

Verwendung nach [RCN-225].

#### 4.2.3 CV31, CV32

Verwendung als Zeiger nach [RCN-225].

#### 4.2.4 RailCom Block

CV31 = 0 und CV32 = 255 adressieren einen Block von 256 CVs, die für RailCom-Anwendungen nach folgender Tabelle belegt sind:

| Byte | Belegung | z/o | R/W |
|------|----------|-----|-----|
| 0-1 | Manufacturer ID (nach NMRA [S-9.2.2 Anhang A], Little Endian). Damit entspricht Byte 0 CV 8 bzw. bei langer Herstellerkennung CV 108 und Byte 1 entspricht CV 107. | z | R |
| 4-7 | Produkt ID (Herstellerspezifische Produktkennung, um die einzelnen Produkte auseinanderhalten zu können. Little Endian) | o | R |
| 8-11 | MUN (Manufacturer Unique Number. Little Endian) 4 Byte Seriennummer über alle Geräte eines Herstellers. | o | R |
| 12-15 | Produktionsdatum (Anzahl der Sekunden seit dem 1.1.2000, Little Endian, Unsigned) | o | R |
| 16-63 | Herstellerspezifische Belegung möglich | o | R/W |
| 64-127 | Dynamische Variablen nach APP DYN, Abschnitt 5.4, Tabelle 12, wobei der Bereich von CV72 = DV 8 bis CV83 = DV 19 den Behältern 1 bis 12 entspricht. Andere DVs können ggf. über ein Schreiben des CVs zurückgesetzt werden. | o | R/W |
| 128 | RailCom Versionsnummer "vor Punkt" , binär | z | R |
| 129 | RailCom Versionsnummer "nach Punkt", binär | z | R |
| 130 | Feature-Nummer für Test Feature ID (siehe 5.7) | o | R |
| 131 | reserviert | | |
| 132-143 | spezifischer Verbrauch, Behälter 1-12 | o | R/W |
| 144 | Füllstand aller Behälter (0... 100), ein Schreibbefehl in diese CV setzt den Inhalt aller Behälter auf den angegebenen Wert. | o | W |
| 145 | Tachoskalierung in der Zentrale, Wert mal 2 = Höchstgeschwindigkeit in km/h | o | R/W |
| 146-255 | reserviert | | |

**Tabelle 9: Belegung Block 255**

z = Zwingend, o = Optional, R = Read (Lesen), W = Write (Schreiben)

### 4.3 DCC-Befehle

Die erweiterte Funktionalität durch RailCom bedingt auch zusätzliche DCC-Befehle. Dazu gehören:

#### 4.3.1 Zusätzliche Funktionskommandos

Durch RailCom ergeben sich zusätzliche Funktionsmöglichkeiten wie z.B. Suchfunktion, Aufgleissuche, etc. (siehe auch unter Abschnitt "Anwendungen (Application/APP) Layer für Fahrzeugdecoder"). Hierfür werden die Binärzustandssteuerungsbefehle kurze Form nach [RCN-212] Abschnitt 2.3.5 benutzt.

**Betriebsbefehl: Binärzustandssteuerungs als RailCom-Befehl**
► `1101-1101 DLLL-LLLL`

Diese Befehle werden in dieser Norm mit XF1 bis 127 bezeichnet.

Von diesen Befehlen sind in [RCN-212] die ersten 28 für besondere Anwendungen wie RailCom reserviert. Für RailCom sind die ersten 15 Befehle vorgesehen.

| XF | Funktion |
|----|----------|
| 1  | Anfordern der Ortsinformation entsprechend Abschnitt 5.3.1 |
| 2  | Aufgleissuche |
| 3  | Ausgabe aller CVs mit CV-Auto ID 12 |
| 4 - 15 | reserviert |

**Tabelle 10: Funktionsnummern**

#### 4.3.2 Erweiterte Programmierbefehle

Die [RCN-214] definiert in Abschnitt 3 für die Programmierung der CVs auch noch den Konfigurationsvariablen-Zugriffsbefehl - Kurze Form. Dieser erlaubt auch das Schreiben zweier festgelegter CV-Paare:

`KKKK = 0100` = Schreiben von CV17 (erstes Datenbyte) und CV18 (zweites Datenbyte) (Erweiterte Adresse) gleichzeitig, und setzen des Bit 5 in CV29.

Rückmeldung erfolgt auf der alten Adresse über zwei aufeinanderfolgende Datagramme mit ID 0, zuerst das erste Datenbyte, danach das zweite Datenbyte. Beide Datagramme müssen im selben Kanal 2 gesendet werden, also 12 Bit Datagramm + 12 Bit Datagramm.

**Betriebsbefehl: POM**
► `1111-0100`
◄ Kanal 2: `0000 (ID 0) DDDD-DDDD + 0000 (ID 0) DDDD-DDDD` mit D = CV-Daten, zuerst CV17, dann CV18

`KKKK = 0101` = Schreiben von CV31 (erstes Datenbyte) und CV32 (zweites Datenbyte) (Zeiger-Wert für erweiterten Bereich, höherwertiges Byte (31) und niederwertiges Byte (32)).

Rückmeldung erfolgt über zwei aufeinanderfolgende Datagramme mit ID 0, zuerst das erste Datenbyte, danach das zweite Datenbyte. Beide Datagramme müssen im selben Kanal 2 gesendet werden, also 12 Bit Datagramm + 12 Bit Datagramm.

**Betriebsbefehl: POM**
► `1111-0101`
◄ Kanal 2: `0000 (ID 0) DDDD-DDDD + 0000 (ID 0) DDDD-DDDD` mit D = CV-Daten, zuerst CV31, dann CV32

#### 4.3.3 NOP für Zubehördecoder

Zubehördecoder melden sich nach einem Schaltbefehl, wenn sie der Zentrale etwas mitteilen wollen (SRQ).

Üblicherweise werden Schaltbefehle aber nur sporadisch gesendet, also könnten sich Zubehördecoder nur ebenso selten bemerkbar machen. Deshalb ist in [RCN-213] Abschnitt 2.5 der NOP-Befehl definiert, der regelmäßig gesendet wird, aber zunächst nichts bewirkt, außer Zubehördecodern ein SRQ zu ermöglichen.

Dieser muss von allen nicht RailCom-fähigen Einfachen und Erweiterten Zubehördecodern als ungültig erkannt und damit ignoriert werden. Er dient zum einen dazu, es Zubehör-Decodern zu ermöglichen, in der nachfolgenden Austastlücke einen SRQ abzusetzen, zum anderen erlaubt er für den Fall, dass sich mehrere Decoder gleichzeitig mit einem SRQ melden, auch die Suche nach den beteiligten Decodern.

Dies wird dadurch erreicht, dass mit dem NOP eine Zubehördecoder-Adresse übertragen wird. Es melden sich daraufhin nur diejenigen Decoder, deren Adresse kleiner oder gleich ist wie die im NOP enthaltene. Dadurch kann bei Meldungen von mehreren Decodern mittels sukzessiver Approximation der Decoder mit der jeweils niedrigeren Adresse ausfindig gemacht und bedient werden. Die Suche wird solange wiederholt, bis sich kein Decoder mehr meldet.

**Betriebsbefehl: NOP**
► `10AA-AAAA 0AAA-1AAT`

Für die regelmäßige Abfrage aller Zubehördecoder sendet die Zentrale sinnvollerweise ein NOP mit der höchstmöglichen Adresse, damit alle Decoder angesprochen werden.

Solange sich hierauf immer nur ein Decoder mit einem SRQ meldet, kann es bei diesem NOP mit der höchsten Adresse bleiben. Erst, wenn sich mehrere Decoder gleichzeitig melden, muss die Zentrale eine Suche starten, indem sie die im NOP enthaltene Adresse geeignet variiert.

Eine RailCom-fähige Zentrale muss zur Abfrage der Zubehördecoder in bestimmten Zeitabständen einen NOP-Befehl senden. Der zeitliche Abstand zwischen zwei NOPs ist ein Kompromiss aus Bandbreiteneinschränkung beim DCC-Signal und Reaktionszeit auf SRQ-Meldungen. Es wird ein Intervall von ca. 0,5 Sekunden empfohlen.

Bei Suchvorgängen nach Mehrfachmeldungen müssen die zur Suche verwendeten NOPs natürlich schnellstmöglich hintereinander gesendet werden.

---

## 5 Anwendungen (Application/APP) Layer für Fahrzeugdecoder

Die nachfolgenden Abschnitte beschreiben die Befehle für die RailCom-Funktionalität für Fahrzeugdecoder mit den in Tabelle 4 als MOB gekennzeichneten Adressbereichen.

### 5.1 POM (ID 0)

POM bedeutet "Programming On the Main", also die Programmierung auf dem Gleis zum Fahren. Es dient dem Lesen und Schreiben von Konfigurationsvariablen im Betriebsmodus entsprechend [RCN-214] Abschnitt 2. Auf diese Befehle wird im Kanal 2 mit einem 12 Bit Datagramm mit der ID 0 = 0000 und 8 Datenbits geantwortet. Die Datenbits enthalten den Wert der CV.

**Betriebsbefehl: POM**
► `1110-KKVV VVVV-VVVV DDDD-DDDD`
► `1110-10VV VVVV-VVVV 111K-DBBB`
◄ Kanal 2: `0000 (ID 0) DDDD-DDDD` mit D = CV-Daten

#### 5.1.1 Byte Lesen

**Betriebsbefehl: POM Byte Lesen**
► `1110-01VV VVVV-VVVV DDDD-DDDD`
◄ Kanal 2 (12Bit): `0000 (ID 0) DDDD-DDDD` mit D = CV-Daten.

Das zugehörige Antwortdatagramm (ID 0) muss nicht im selben Paketrahmen gesendet werden, sondern kann zu einem späteren Zeitpunkt erfolgen. Eine Zentrale muss also dafür sorgen, dass der Decoder nochmals adressiert wird und vorher kein anderer Programmierbefehl an die gleiche Adresse gesendet wird (der gleiche ist erlaubt).

Wenn der Lesevorgang beendet ist, sendet der Decoder auf den zugehörigen, erneuten Lesebefehl das Ergebnis. Gibt der Decoder nicht innerhalb von 0,5s die Daten zurück dann gilt der Lesevorgang als fehlgeschlagen.

#### 5.1.2 Byte Schreiben

**Betriebsbefehl: POM Byte Schreiben**
► `1110-11VV VVVV-VVVV DDDD-DDDD`
◄ Kanal 2 (12Bit): `0000 (ID 0) DDDD-DDDD` Hier wird mit D = CV-Daten der Wert zurückgeschickt, der nach der POM Operation in der CV vorhanden ist.

Beim Schreiben soll der Decoder wie folgt antworten: Mit einem ACK, solange der neue Wert noch nicht geschrieben ist, mit dem neuen Wert, wenn der neue Wert erfolgreich geschrieben wurde, mit einem ACK gefolgt von einem NACK innerhalb einer RailCom Nachricht wenn die CV nicht unterstützt wird oder einem anderen Wert, wenn der geschriebene Wert nicht angenommen werden kann. Anstelle eines ACK kann auch mit einer anderen nicht-befehlsbezogenen Meldung geantwortet werden.

Gibt der Decoder nicht innerhalb von 0,5s einen Wert zurück dann gilt der Schreibvorgang als fehlgeschlagen. Bei einer CV, die nur gelesen werden kann, liefert der Decoder den aktuellen Wert der CV.

#### 5.1.3 Bit Schreiben

**Betriebsbefehl: POM Bit Schreiben**
► `1110-10VV VVVV-VVVV 1111-DBBB`
◄ Kanal 2 (12Bit): `0000 (ID 0) DDDD-DDDD` Hier wird mit D = CV-Daten der Wert zurückgeschickt, der nach der POM Operation in der CV vorhanden ist.

Antworten wie bei "Byte Schreiben". Der Befehl Bit lesen ist für RailCom uninteressant, da immer das ganze Byte zurückgemeldet wird.

### 5.2 ADR (IDs 1 & 2)

Diese Rückmeldung dient der Adressfeststellung von Fahrzeugdecodern auf der Anlage. Mit Hilfe von ortsfesten Detektoren kann sie zur Lokalisierung verwendet werden.

Fahrzeugdecoder nutzen Kanal 1 als Broadcast Kanal für die eigene Adresse. Im Cutout nach jedem an einen Fahrzeugdecoder gerichteten DCC Paket (siehe Kennzeichnung MOB in Tabelle 4) senden sie ihre aktive Adresse (Basis, Erweiterte. Mehrfachtraktions- oder ggf. DCC-A Adresse). Hierfür werden die folgenden 12-Bit Datagramme mit ID 1 und ID 2 definiert, wobei eine DCC-A-Adresse wie die Basis oder Erweiterte Adresse übertragen wird:

| ADR1 (ID 1) | ADR2 (ID 2) | Adresse |
|---|---|---|
| `0 0 0 0 0 0 0 0` | `0 A6 A5 A4 A3 A2 A1 A0` | Basis-Adresse (CV1) |
| `0 1 1 0 0 0 0 0` | `R A6 A5 A4 A3 A2 A1 A0` | Mehrfachtraktionsadresse (CV19) |
| `1 0 A13 A12 A11 A10 A9 A8 A7` | `A6 A5 A4 A3 A2 A1 A0` | Erweiterte Adresse (CV17+CV18) |

**Tabelle 11: ADR-Zuordnung Adresse**

Lange Mehrfachtraktionsadressen (CVs 19 und 20) werden wie normale lange Adressen gesendet.

Ein Decoder muss abhängig von seiner aktiven Adresse die beiden Datagramme ADR1 und ADR2 alternierend senden. Die "aktive Adresse" ist die, unter der der Decoder seine Fahrbefehle erhält.

**Betriebsbefehls-Antwort: ADR**
► Betriebsbefehl an Fahrzeugdecoder entsprechend [RCN-212] Abschnitt 2
◄ Kanal 1: `0001 (ID 1) ADR1` oder `0010 (ID 2) ADR2`

**Mögliche Anwendung:**
Lokale Detektoren (Local Detector) auf der Anlage werten diese Datagramme zeitnah aus und senden diese Informationen weiter (Zentrale, Computer etc.). Auf diese Weise kann die Zentrale erfahren, welcher Decoder sich auf einem bestimmten Gleisabschnitt befindet. Abbildung 5 zeigt dies schematisch.

Dieses Verfahren eignet sich besonders zur Zugbeeinflussung.

*Bild 5: Lokalisierung Fahrzeugdecoder*

Die Lokalisierung eines Decoders nach obigem Muster kann nur funktionieren, wenn der Decoder sich alleine auf dem vom Lokalen Detektor überwachten Gleisabschnitt befindet. Problematisch ist dies jedoch im Multitraktionsbetrieb. Hierfür wird empfohlen, dass nur die führende Lok die ADR-Datagramme auf Kanal 1 sendet, während bei den folgenden Loks diese Funktion via CV28 deaktiviert ist. Dies kann beim Zusammenstellen des Fahrzeugverbunds via POM geschehen.

#### 5.2.1 Dynamische Kanal-1-Nutzung

Hierbei wird das Senden der Adresse in Kanal 1 automatisch abgeschaltet, um Kollisionen zu reduzieren. Der Decoder sendet in Kanal 1:
- Nach einem Neustart
- Nach einer Adressänderung
- Wenn er für eine Zeit von mehr als 5s nicht mehr adressiert wurde.

Wenn in CV28 Bit 2 gesetzt ist, wird die Aussendung im Kanal 1 nach dem achtmaligen Empfang der eigenen Lokadresse von selbst abgeschaltet. Damit wird eine neue Lok erkannt und stört, nachdem sie vom System angesprochen wird, nicht mehr die Erkennung weiterer Loks.

#### 5.2.2 Info1 (ID 3)

Um der einem lokalen Detektor weitere Informationen mitzuteilen, kann der Decoder zusätzlich zu den IDs 1 und 2 auch zyklisch im Kanal 1die ID 3 senden, d.h. es werden der Reihe nach ID 1, ID 2, ID 3, ID 1, … übertragen. Dieses muss über die CV28 Bit 3 freigegeben sein. Zusätzlich gelten die Bedingungen für die IDs 1 und 2, d.h. ID 3 darf nur gesendet werden, wenn auch die IDs 1 und 2 im Kanal 1 freigegeben sind und nur im Cutout nach einem an einen Fahrzeugdecoder gerichteten DCC Paket.

| Bit | Funktion |
|---|---|
| 0 | Aufgleisrichtung = Polarität des Gleissignals nach [RCN-210] Abschnitt 2.3 (1 = positiv, 0 = negativ) |
| 1 | Fahrrichtung = Polarität des Gleissignals bezogen auf die Fahrtrichtung anstatt auf die Anschlüsse des Decoders inklusive CV 29 Bit 1 und ggf. CV 19 Bit 7 (entspricht dem Bit 1 „OW“ in DV 27) (1 = negativ, 0 = positiv) |
| 2 | Fahrzustand (1 = fährt, 0 = steht) |
| 3 | 1 = Teil einer Mehrfachtraktion |
| 4 | 1 = Anforderung zur Adressierung, um eine Meldung in Kanal 2 senden zu können |
| 5 – 7 | reserviert |

**Tabelle 12 Bedeutung ID 3 in Kanal 1.**

#### 5.2.3 Aufgleissuche (ID 1, 2 und 14)

Dieses ist eine spezielle Anwendung, um ein Fahrzeug auf der Anlage zu identifizieren. Dazu wird das Fahrzeug durch Abkippen oder auf anderem Weg kurzzeitig von der Gleisspannung getrennt. Die Trennung hat für mindestens 1 Sekunde zu erfolgen. Nachdem der Decoder wieder Spannung erhält, antwortet er für maximal 30 Sekunden auf den Befehl "XF2 aus" an die Broadcast-Adresse 0 mit seiner Adresse in Kanal 2. In dieser Zeit muss der Anwender über die Zentrale diesen Befehl auslösen.

**Betriebsbefehls-Antwort: ADR / ZEIT**
► Suchbefehl: kurzer Binärzustandssteuerungsbefehl "XF2 aus" entsprechend [RCN-212] Abschnitt 2.3.5 an die Broadcast-Adresse 0: `1101-1101 0000-0010`
◄ Kanal 2 vom Decoder drei 12 Bit Datagramme:
- `0001 (ID 1) DDDD-DDDD`: adr_high entsprechend Tabelle 11
- `0010 (ID 2) DDDD-DDDD`: adr_low entsprechend Tabelle 11
- `1110 (ID 14) DDDD-DDDD`: Zeit in Sekunden seitdem der Decoder wieder Spannung hat bis zum Empfang des ersten Suchbefehls, unabhängig davon, ob er diesen beantwortet oder nicht.

Der Decoder sollte nicht auf jeden Befehl "XF2 aus" sondern statistisch (durchschnittliche Wahrscheinlichkeit ca. 1:8) an die Broadcast-Adresse 0 antworten, damit die Aufgleissuche auch mehrere gleichzeitig (= knapp hintereinander) aufgegleiste Fahrzeuge erkennen und listen kann. Darunter können sich auch Fehlmeldungen befinden (von Fahrzeugen mit zufälligen kurzzeitigen Kontaktunterbrechungen) befinden, wobei die Zeitangaben (Rückkehr der Spannung bis Empfang des ersten Suchbefehls) bei der Erkennung helfen können.

Der Decoder sollte nur so lange (statistisch) auf die Befehle "XF2 aus" antworten, solange die Folge der Befehle "XF2 aus" nicht für mehr als 1 Sekunde unterbrochen ist, also die Zeitdifferenz zwischen zwei empfangenen "XF2 aus" nicht größer als 1 Sekunde ist.

Es wird empfohlen, den Befehl "XF2 aus" etwa 8 Mal pro Sekunde zu senden.

#### 5.2.4 Decoderanmeldung über die Programmieradresse 0000

Dies ist ein sehr einfaches Verfahren zur Erkennung von (neuen) Decodern auf der Anlage. Es kann mit einem globalen oder bevorzugt auf einem lokalen RailCom-Detektor angewendet werden. Bei diesem Verfahren kann immer nur ein Decoder erkannt werden.

Die Zentrale sendet alle 2 bis 3 Sekunden einen speziellen Anmeldebefehl. Dieser besteht aus der 14 Bit Fahrzeugadresse "0" mit einem POM-Lesebefehl auf CV29. Auf diesen Befehl dürfen nur Decoder antworten, Bei denen das Anmeldebit "4" in CV28 gesetzt ist.

Wenn der Decoder trotz aktivem Bit 4 in der CV 28 innerhalb von 5 Sekunden keinen Anmeldebefehl sieht, geht er in den normalen Betriebsmodus. Bis dahin ignoriert er seine Adresse.

Die Zentrale wertet den empfangenen Inhalt von CV29 aus. Je nach Ergebnis fragt sie dann ebenfalls per POM die 7-Bit oder die 14-Bit Fahrzeugadresse ab. Bei gesetztem Bit 7 in CV29 kann sie auch die 11Bit Zubehöradresse abfragen.

Im Dialog mit dem Anwender wird der neue Decoder dauerhaft oder temporär in die interne Datenbank übernommen. Wenn die kurze Fahrzeugadresse 3 oder die Zubehöradresse 1 gelesen wurde, kann ein Vorschlag zur neuen Adressvergabe erfolgen. Ebenso, wenn die ausgelesene Adresse für ein anders vorhandenes Fahrzeug in der Datenbank hinterlegt ist.

Nach Beendigung der Anmeldung sollte Bit 4 in CV29 von der Zentrale automatisch gelöscht werden.

Wenn dieses Anmeldeverfahren unterstützt wird, sollte das Bit 4 in CV 28 ab Werk gesetzt sein und bei einem Reset des Decoders durch Programmierung von CV 8 auf 8 ebenfalls gesetzt werden. Zum Setzen von Bit 4 in CV 28 kann neben den normalen Programmier-verfahren auch ein spezieller Wert verwendet werden, der in CV 8 geschrieben wird.

### 5.3 EXT (ID 3)

Diese Rückmeldung dient der Übertragung einer Ortsinformation. Damit kann der Ort des Fahrzeugdecoders einer gegebenen Adresse festgestellt und ggf. ein Befüllen von Vorräten ausgelöst werden.

#### 5.3.1 Senden der Ortsinformation

Die Ortsinformation kann durch den Decoder oder den Detector gesendet werden, je nachdem, wo die Information vorliegt.

**Fall 1: Ortsinformation liegt im Decoder vor (z.B. durch Infrarotübertragung).**

**Betriebsbefehls-Antwort: EXT**
► kurzer Binärzustandssteuerungsbefehl "XF1 aus" entsprechend [RCN-212] Abschnitt 2.3.5: `1101-1101 0000-0001`
◄ Kanal 2 vom Decoder: `0011 (ID 3) 00 TTTT-PPPP-PPPP`
- `TTTT = 0000 – 0111`: Ortsinformation (Position): 0PPP
- `TTTT = 1000 – 1111`: reserviert
- `0PPP-PPPP-PPPP`: 11 Bit Ortsadresse (Position)

Wenn die Ortsinformation im Decoder vorliegt, kann sie auch spontan in Kanal 2 mit der ID DYN übertragen werden. Siehe Abschnitt 5.4.

**Fall 2: Ortsinformation liegt im Detector vor.**

**Betriebsbefehls-Antwort: EXT**
► kurzer Binärzustandssteuerungsbefehl "XF1 aus" entsprechend [RCN-212] Abschnitt 2.3.5: `1101-1101 0000-0001`
◄ Kanal 2 vom Decoder: `0011 (ID 3) 01`
◄ Kanal 2 von Detector: `TTTT-PPPP-PPPP`
- `TTTT = 0000 – 0111`: nur Ortsinformation
- `TTTT = 1000`: reserviert
- `TTTT = 1001`: reserviert
- `TTTT = 1010`: Dieseltankstelle
- `TTTT = 1011`: Kohlebansen
- `TTTT = 1100`: Wasserkran
- `TTTT = 1101`: Besandungsanlage
- `TTTT = 1110`: Ladestation (Akku)
- `TTTT = 1111`: Allgemeine Füllstation
- `PPPP-PPPP`: 8 Bit Ortsadresse (Position)

Der Detector funktioniert wie in Abbildung 5, wird aber um einen RailCom-Sender ergänzt. Da die Ortsinformation über das Gleis zurück gesendet wird, ist kein weiterer Anschluss an z.B. ein Bussystem notwendig.

#### 5.3.2 Befüllen

Das Befüllen eines Behälters oder aller Behälter erfolgt mit dem Befehl "Byte Schreiben" aus Abschnitt 5.1.2 auf die entsprechenden CVs in dem RailCom-Block (CV31=0 & CV32=255).

### 5.4 Aktuelle Fahrinformation (ID 4)

Diese Meldung soll dazu dienen, aktuelle Informationen über den Fahrzustand vom Decoder initiiert zur Zentrale zu übertragen. Im Gegensatz zu DYN (ID 7) können hier 32 statt 8 Bit in einem Datagramm übertragen werden. Da es noch keine genaue Spezifikation gibt, ist die ID4 bisher nur reserviert.

### 5.5 DYN (ID 7)

Diese Rückmeldung dient der Übertragung dynamischer Informationen von Fahrzeug-decodern. Unter "Dynamischen Informationen" werden Dynamische Variablen (DVs) verstanden, die sich während des Betriebes ändern (z.B. Geschwindigkeit, Tankinhalt etc.). Die RailCom-CVs 64-127 (siehe Abschnitt 4.2.4, Tabelle 9) entsprechen DVs, die durch Programmierung geändert werden können.

**Betriebsbefehls-Antwort: DYN**
► Betriebsbefehl an Decoderadresse entsprechend [RCN-212] Abschnitt 2
◄ Kanal 2 18Bit [+ 18Bit]: `0111 (ID 7) DDDD-DDDD-XXXX-XX` [`0111 (ID 7) DDDD-DDDD-XXXX-XX`]
mit D = DV-Wert und X = Subindex zur Kennzeichnung der DV

Die Übertragung von dynamischen Variablen (DV) (z.B. Geschwindigkeit, Behälter, ...) erfolgt in einem 18 Bit Datagramm (ID 7), welches den 8 Bit Wert der DV (D) sowie einen 6 Bit Subindex (X) enthält, der eine von 64 möglichen DVs selektiert. Die Bedeutung der DV ist durch den Subindex festgelegt.

2 beliebige DVs können in einem Rückmeldeframe übertragen werden. Welche DVs ein Decoder wann sendet bestimmt er selbst.

| X | Bedeutung |
|---|---|
| 0 | Echte Geschwindigkeit Teil 1 ¹ |
| 1 | Echte Geschwindigkeit, Teil 2 ¹ |
| 2 | `0LLL LLLL` = Last gemäß Susi-Spezifikation, `1GGG GGGG` = Geschwindigkeit, normiert auf 128 Fahrstufen |
| 3 | RailCom Version als 2x 4 Bit "Hauptversion Nebenversion", 0x15 = Version 1.5 |
| 4 | Änderungs-Flags (Changeflags aus RCN-218) |
| 5 | Flag Register, Inhalte noch festzulegen |
| 6 | Input Register, Belegung noch festzulegen |
| 7 | Empfangsstatistik: Der Fahrzeugdecoder führt eine Statistik über alle empfangenen DCC-Pakete und übermittelt die Zahl fehlerhafter Pakete / Gesamtzahl in %. (Wertebereich 0-100). |
| 8-19 | Inhalt des Behälters 1-12 in % (Wertebereich 0-100) |
| 20 | Datagramm 1: Ortsadresse niederwertigste 8 Bits; Datagramm 2: Ortsadresse höherwertigste 3 Bits in den Bits 0 bis 2, die Bits 3 bis 7 sind reserviert auf 0 zu setzen. ² |
| 21 | Warn- und Alarmmeldungen ³ |
| 22 | Tageskilometerzähler, genaue Definition noch festzulegen |
| 23 | Wartungsintervall ⁴ |
| 24-25 | reserviert |
| 26 | Temperatur: Wertebereich von 0 = -50°C bis 255 = +205°C |
| 27 | Richtungszustandsbyte für Ost-West-Steuerung. ⁵ |
| 28-45 | Reserviert |
| 46 | Vom Decoder gemessene Gleisspannung = 5V + Wert * 100 mV |
| 47 | Vom Decoder berechneter Anhalteweg in m bis zum Stillstand, Einheit 4 m (Maximalwert 1 km beim Vorbild) |
| 48-63 | Reserviert |

**Tabelle 13: Dynamische Informationen Fahrzeugdecoder**

¹) Hinweis zur Übertragung der echten Geschwindigkeit:
Der Decoder berechnet die wirklich auf der Anlage gefahrene Vorbildgeschwindigkeit. Diese Berechnung erfolgt herstellerabhängig, wegen der Abhängigkeit von der internen Software-Struktur des Decoders. Die Angaben sind in km/h. Eine ggf. notwendige Umrechnung in mph erfolgt im Anzeigegerät. Bis zum Wert 255 erfolgt die Übertragung ausschließlich in ID 7 DYN 0. Ist die Geschwindigkeit höher, wird ausschließlich(!) die Differenz (also berechnete Geschwindigkeit in km/h minus 256) in ID 7 DYN 1 übertragen. D.h. das höchstwertigste Bit der Geschwindigkeit ist das niederwertigste Bit im Subindex zur Kennzeichnung der DV:

`RailCom Meldung: 0 1 1 1 | DDDD-DDDD | 0000-0D`
`Geschwindigkeit: ID 7 | G7 G6 G5 G4 - G3 G2 G1 G0 | Subindex G8`

Für die Skalierung des Tachos auf dem Anzeigegerät wird auf das Byte 145 (= CV 402) im über CV31 = 0 und CV32 = 255 adressierten RailCom Block (Abschnitt 4.2.4) verwiesen.

²) Bei der Ortsadresse DV 20 sind beide Adressteile in jeweils einem 18 Bit Datagramm innerhalb eines Kanals zu übertragen, wobei zuerst die niederwertigste 8 Bits übertragen werden. Bei Adressen < 256 reicht ein einzelnes Datagramm.

³) Die Status- und Alarmmeldungen in DV 21 sind folgendermaßen festgelegt:
Bit 7 = 0: Warnung, Bit 7 = 1 Alarm.
Bit 6 = 0: Warnungen bzw. Alarme unabhängig von anderen DVs entsprechend Tabelle 14. Alle dort nicht aufgeführten Werte sind reserviert.
Bit 6 = 1: Warnungen bzw. Alarme bezogen auf die DVs 0 bis 63. Die DV-Nummer steht in den Bits 0 bis 5.

| Wert | Bedeutung |
|---|---|
| 128 | Alarm Kurzschluss Motorausgang |
| 129 | Alarm Kurzschluss Funktionsausgang |
| 130 | Alarm Übertemperatur |

**Tabelle 14: Warnungen und Alarme unabhängig von DVs**

⁴) Durch schreiben von 255 in die DV über RailCom-CV 87 wird der Zähler für das Wartungsintervall zurückgesetzt. Der Decoder zählt ggf. konfigurierbar den Zähler runter in Abhängigkeit des Betriebszustandes. Bei einem Schwellenwert und bei erreichend der 0 wird eine Warnung bzw. Alarm über DV21 gesendet.

⁵) Rückmeldung zum in [RCN-212] Abschnitt 2.2.3 definierten Sonderbetriebsarten-Befehl.
- Bit 0: „VR“ Fahrzeugbezogene Richtung in die gefahren werden soll.
- Bit 1: „OW“. Anlagenbezogene Fahrrichtung: 0 = West, 1 = Ost
- Bit 2: Richtungskontrolle; 0 = Richtung entsprechend Fahrbefehl, 1 = Richtung entsprechend der Ost-West-Steuerung
- Bit 3: Richtungswechsel; 0 = normal, 1 = Lok gerade in Abbremsphase innerhalb eines Richtungswechsels
- Bit 4: OW-Ausblenden; 0 = normal, 1 = OW-Richtungspfeile sollen nicht angezeigt werden.
- Bit 5: OW-Invers; 0 = normal, 1 = Anzeige des anderen Richtungspfeils.
- Bit 6 & 7: Reserviert

„West“ ist definiert als bei positiver Polarität des Gleissignals nach [RCN-210] Abschnitt 2.3 vorwärts und rückwärts bei negativer Polarität. „Ost“ ist entsprechend umgekehrt definiert.

### 5.6 XPOM (ID 8 bis ID 11)

POM bedeutet "Programming On the Main", also die Programmierung auf dem Gleis zum Fahren. XPOM ist ein gegenüber dem im Abschnitt 5.1definierten POM erweitertes Format zum Schreiben und Lesen von bis zu vier CVs im Betriebsmodus entsprechend [RCN-214] Abschnitt 4. Auf diese Befehle wird im Kanal 2 mit einem 36 Bit Datagramm mit der ID 8 = 1000 bis ID 11 = 1011 und 32 Datenbits geantwortet. Die Datenbits enthalten den Wert von vier aufeinanderfolgenden CVs.

**Betriebsbefehl: XPOM**
► `1110-KKSS VVVV-VVVV VVVV-VVVV VVVV-VVVV {DDDD-DDDD {DDDD-DDDD {DDDD-DDDD {DDDD-DDDD}}}}`
◄ Kanal 2 (36 Bit): `10SS (ID 8 - 11) DDDD-DDDD DDDD-DDDD DDDD-DDDD DDDD-DDDD` mit D = CV-Daten

Es werden unabhängig von der Anzahl der geschriebenen Bytes und auch beim Schreiben nur eines Bits immer die Werte von vier CVs zurückgemeldet.

Die Zuordnung zwischen Befehl und Antwort erfolgt mittels Sequenznummer SS und Datagramm-ID wie folgt:
- SS = 00 – ID 8 1000
- SS = 01 – ID 9 1001
- SS = 10 – ID 10 1010
- SS = 11 – ID 11 1011

Das zum XPOM-Befehl zugehörige Antwort-Datagramm (ID 8 ... ID 11) muss nicht im selben Paketframe gesendet werden, sondern kann zu einem späteren Zeitpunkt erfolgen.

Der Decoder muss eine Warteschlange für 4 XPOM-Befehle implementieren und diese der Reihe nach abarbeiten. Wiederholt gesendete XPOM-Befehle mit derselben Sequenznummer werden nur einmal in die Warteschlange aufgenommen. Durch das zugeordnete Antwort-Datagramm wird die Operation abgeschlossen und der entsprechende Eintrag in der Warte-schlange wieder freigegeben. Beim Schreiben per XPOM erfolgt die Antwort erst nach dem eigentlichen Schreibvorgang. Auf diese Weise kann die Zentrale auf die Schreibgeschwindig-keit des Decoders synchronisieren. Bei ausbleibendem Antwort-Datagramm muss der letzte Befehl mit derselben Sequenznummer wiederholt gesendet werden. Beim Schreiben von nur lesbaren CVs liefert der Decoder den aktuellen Wert der CVs. Ob ein Schreibzugriff akzeptiert wurde muss von der Zentrale durch Vergleich von Befehl und Antwort ermittelt werden.

Der Decoder muss insbesondere schnelles, blockweises Lesen unterstützen, d.h. bei aufeinanderfolgenden XPOM Lesebefehlen muss die Antwort des n-ten XPOM Lesebefehls spätestens im Cutout des (n+2)-ten XPOM Lesebefehls gesendet werden. Auf diese Weise ist ein sehr schnelles Lesen möglich.

#### 5.6.1 XPOM Byte Lesen

**Betriebsbefehl: XPOM Byte Lesen**
► `1110-01SS VVVV-VVVV VVVV-VVVV VVVV-VVVV`
◄ Kanal 2 (36 Bit): `10SS (ID 8-11) CV[V+0] CV[V+1] CV[V+2] CV[V+3]`

Zum Zeitpunkt der Rückmeldung ist der vorhergehende Text zu beachten.

#### 5.6.2 Byte Schreiben

**Betriebsbefehl: POM Byte Schreiben**
► `1110-11SS VVVV-VVVV VVVV-VVVV VVVV-VVVV {DDDD-DDDD {DDDD-DDDD {DDDD-DDDD {DDDD-DDDD}}}}`
◄ Kanal 2 (36 Bit): `10SS (ID 8-11) CV[V+0] CV[V+1] CV[V+2] CV[V+3]`

Zum Zeitpunkt der Rückmeldung ist der vorhergehende Text zu beachten. Es werden immer die CV-Werte wie nach dem Schreibvorgang zurückgegeben, auch wenn die Schreiboperation nicht oder aufgrund eines begrenzten Wertebereichs nur teilweise ausgeführt werden konnte.

#### 5.6.3 Bit Schreiben

**Betriebsbefehl: XPOM Bit Schreiben**
► `1110-10SS VVVV-VVVV VVVV-VVVV VVVV-VVVV 1111-DBBB`
◄ Kanal 2 (36 Bit): `10SS (ID 8-11) CV[V+0] CV[V+1] CV[V+2] CV[V+3]`

Antworten wie bei "Byte Schreiben". Der Befehl Bit lesen ist für RailCom uninteressant, da immer das ganze Byte zurückgemeldet wird.

### 5.7 CV-Auto (ID 12)

Diese Rückmeldung dient der Übertragung von CVs von Fahrzeugdecodern im Hintergrund. Der Decoder kann jederzeit CVs senden. Mit dem Befehl X3 kann die Übertragung aller CVs angestoßen werden:

**Betriebsbefehls-Antwort: CV-Auto**
► kurzer Binärzustandssteuerungsbefehl "XF3 an" entsprechend [RCN-212] Abschnitt 2.3.5: `1101-1101 0000-0011`
◄ Kanal 2 vom Decoder: ACK oder eine beliebige Antwort, die spontan gesendet werden darf – auch aber nicht zwingend CV-Auto

Danach sendet der Decoder alle seine CVs, wenn er adressiert wird und so ihm der Kanal 2 zur Verfügung steht. Dieses erfolgt aber zur Sicherheit der Übertragung nicht als Block, sondern jede Antwort enthält alle notwendigen Informationen, um die Nachricht auszuwerten.

**Betriebsbefehls-Antwort: CV-Auto abbrechen**
► kurzer Binärzustandssteuerungsbefehl "XF3 aus" entsprechend [RCN-212] Abschnitt 2.3.5: `1101-1101 0000-0011`
◄ Kanal 2 vom Decoder: ACK oder eine beliebige Antwort, die spontan gesendet werden darf –aber nicht mehr CV-Auto

Der Decoder hat das Senden seiner CVs einzustellen.

**Betriebsbefehls-Antwort: CV-Auto**
► Betriebsbefehl an Decoderadresse entsprechend [RCN-212] Abschnitt 2
◄ Kanal 2 36 Bit : `0100 (ID 4) VVVV-VVVV VVVV-VVVV VVVV-VVVV DDDD-DDDD`

`VVVV-VVVV VVVV-VVVV VVVV-VVVV` ist die 24 Bit lange Adresse der übertragenen CV. Es werden die höherwertigen Adressbits im ersten Byte übertragen. Im Vergleich zum Zugriff über die CVs 31 und 32 ergibt sich damit, dass das erste `VVVV-VVVV` Byte dem Inhalt der CV 31 entspricht, das zweite `VVVV-VVVV` Byte dem Inhalt von CV 32 und das dritte `VVVV-VVVV` Byte dem zweiten Byte des „Zugriffsbefehl - Lange Form“ entsprechend [RCN-214] entspricht. Damit können alle CVs eines Decoders adressiert werden. Die acht Bits `DDDD-DDDD` enthalten den in der CV gespeicherten Wert.

---

## 6 Anwendung für Zubehördecoder (Weichen etc.)

### 6.1 SRQ - Service Request für Zubehördecoder

Der Kanal 1 des Cutouts wird von Zubehördecodern benutzt, um die Zentrale zu einer Kommunikation zu veranlassen. Diese Aufforderung wird im Folgenden als SRQ (Service Request) bezeichnet.

Der SRQ kann entweder nach einem beliebigen Zubehördecoder-Paket gesendet werden (gleichgültig welche Adresse damit angesprochen wird und gleichgültig, ob es ein Einfaches oder ein Erweitertes Zubehörsteuerungspaket ist) oder nach einem NOP, wenn die eigene Adresse kleiner oder gleich der im NOP enthaltenen ist. (Vgl. Kapitel 4.3.4)

Bei einem SRQ nach einem NOP ist die entsprechende Meldung in Kanal 2 gleich mitzusenden, um etwas Zeit zu sparen. Erfolgt der SRQ jedoch nach einem regulären Zubehördecoder-Befehl, so darf die Meldung nicht gesendet werden, damit die Meldungen des adressierten Decoders nicht unkenntlich gemacht werden.

Beim SRQ handelt es sich um ein 12-Bit-Datagramm. Im Gegensatz zu allen anderen Datagrammen enthält der SRQ keine Kennung, vielmehr werden die 12 Nutzbits zur Übertragung der kompletten Zubehöradresse herangezogen.

Bei den Betriebsbefehlen für Zubehördecoder sind Adresse und Daten so kombiniert, dass die Adresse Teil des angegebenen Befehls ist. Daher wird hier das gesamte Befehlspaket (aber ohne Synchronbits und Prüfbyte) dargestellt.

**Betriebsbefehle Zubehörsteuerung:**
► `10AA-AAAA 1AAA-DAAR` (Einfache Zubehörsteuerung)
► `10AA-AAAA 0AAA-0AA1 DDDD-DDDD` (Erweiterte Zubehörsteuerung)
► `10AA-AAAA 0AAA-1AAT` (NOP Befehl)
◄ Kanal 1: `0 A10 A9 A8 A7 A6 A5 A4 A3 A2 A1 A0` (Einfache Zubehördecoder)
◄ Kanal 1: `1 A10 A9 A8 A7 A6 A5 A4 A3 A2 A1 A0` (Erweiterte Zubehördecoder)
◄ Kanal 2 nur bei Antwort auf NOP: den SRQ betreffende Meldung, z. B. Fehler

Durch die Beschränkung der Adressauflösung bei Einfachen Zubehördecodern auf Ausgangspaare erhält man ebenso wie bei den Erweiterten Zubehördecodern eine 11-Bit-Adresse und kann dadurch mit dem 12. Bit des SRQ-Datagramms zwischen diesen beiden Kategorien unterscheiden.

Hat ein Decoder einen SRQ abgesetzt, muss er diesen wiederholen, bis er behandelt wurde. Der Decoder darf in dieser Zeit auf keine an sich gerichteten Stellbefehle reagieren.

Ein SRQ gilt als behandelt, wenn der Decoder auf der eigenen Adresse einen Löschbefehl erhalten hat. Als Löschbefehl dient der "Coil Off"-Befehl bzw. der "absolute stop"-Befehl. In diesem Zustand werden die genannten Befehle als solche nicht ausgeführt, sondern bewirken lediglich, dass der SRQ nicht mehr gesendet wird.

**Löschbefehl für Einfache Zubehördecoder: Coil off**
Format: `10AA-AAAA 1AAA-0AA0`

**Löschbefehl für Erweiterte Zubehördecoder: Absolute stop (=Aspect 0)**
Format: `10AA-AAAA 0AAA-0AA1 0000-000`

Hinweis: Eine RailCom-fähige Zentrale sendet regelmäßig einen NOP, um SRQs zu ermöglichen. Empfängt ein Zubehördecoder in den ersten 5 Sekunden nach dem ersten Empfang des DCC-Formates keine NOPs, so darf er davon ausgehen, dass die Zentrale nicht RailCom-fähig ist, somit keine SRQs bearbeitet werden können und er auch keine senden braucht. In diesem Fall wird die Funktion des Decoders nicht blockiert.

### 6.2 POM (ID 0)

POM bedeutet "Programming On the Main", also die Programmierung auf dem Gleis zum Fahren. Da Zubehördecoder meistens fest mit dem Digitalsignal für den Betrieb verbunden sind erlauben diese Befehle das Lesen und Schreiben von Konfigurationsvariablen im Betriebsmodus entsprechend [RCN-214] Abschnitt 2. Auf diese Befehle wird im Kanal 2 mit einem 12 Bit Datagramm mit der ID 0 = 0000 und 8 Datenbits geantwortet. Die Datenbits enthalten den Wert der CV.

Die POM Befehle von der Zentrale zum Decoder (►) sind jeweils ohne die Adressierungs-Daten notiert. Die Adressierung erfolgt entsprechend [RCN-214] Abschnitt 2.1.

**Betriebsbefehle: POM**
► `1110-KKVV VVVV-VVVV DDDD-DDDD`
► `1110-10VV VVVV-VVVV 111K-DBBB`
◄ Kanal 2: `0000 (ID 0) DDDD-DDDD` mit D = CV-Daten

#### 6.2.1 Byte Lesen

**Betriebsbefehl: POM Byte Lesen**
► `1110-01xx`
◄ Kanal 2 (12Bit): `0000 (ID 0) DDDD-DDDD` mit D = CV-Daten.

Das zugehörige Antwortdatagramm (ID 0) muss nicht im selben Paketrahmen gesendet werden, sondern kann zu einem späteren Zeitpunkt erfolgen. Eine Zentrale muss also dafür sorgen, dass der Decoder nochmals adressiert wird und kein anderer Befehl an diesen Decoder gesendet wird (der gleiche ist erlaubt).

Wenn der Lesevorgang beendet ist, sendet der Decoder auf den zugehörigen, erneuten Lesebefehl das Ergebnis. Gibt der Decoder nicht innerhalb von 0,5s die Daten zurück dann gilt der Lesevorgang als fehlgeschlagen.

#### 6.2.2 Byte Schreiben

**Betriebsbefehl: POM Byte Schreiben**
► `1110-11xx`
◄ Kanal 2 (12Bit): `0000 (ID 0) DDDD-DDDD` hier wird mit D = CV-Daten der Wert zurückgeschickt, der nach der POM Operation in der CV vorhanden ist.

Gibt der Decoder nicht innerhalb von 0,5s die Daten dann gilt der Schreibvorgang als fehlgeschlagen.

Bei einer CV, die nur gelesen werden kann, liefert der Decoder den aktuellen Wert der CV.

#### 6.2.3 Bit Schreiben

**Betriebsbefehl: POM Bit Schreiben**
► `1110-10xx`
◄ Kanal 2 (12Bit): `0000 (ID 0) DDDD-DDDD` Hier wird mit D = CV-Daten der Wert zurückgeschickt, der nach der POM Operation in der CV vorhanden ist.

Antworten wie bei "Byte Schreiben".

### 6.3 STAT1 (ID 4)

Diese Rückmeldung dient der Übertragung von Statusnachrichten von Zubehördecodern, Teil 1

**Betriebsbefehls-Antwort: STAT1**
► `10AA-AAAA 1AAA-DAAR` oder `10AA-AAAA 0AAA-0AA1`
◄ Kanal 2 12Bit: `0100 (ID 4) DDDD-DDDD`

Der Statuscode kann nach Zubehördecoderbefehlen als Quittung zurückgesendet werden. Auf ein "ACK" kann dann verzichtet werden.

**1. Datagramm für einfache Zubehördecoder:**

| Bit | Bedeutung |
|---|---|
| 11 ... 8 | Identifier 0x4 |
| 7 | reserviert |
| 6 | 0: Ausgangszustand stimmt nicht mit dem letzten empfangenen Befehl überein. 1: Ausgangszustand stimmt mit dem letzten empfangenen Befehl überein. |
| 5 | 0: der zurückgemeldete Zustand ist der Sollwert, 1: der zurückgemeldete Zustand ist der Istwert anhand echter Rückmeldung |
| 4 ... 0 | Aktueller Zustand. Z.B. Weichendecoder haben 2 Ausgangszustände |

**Tabelle 15: Statusmeldungen für einfache Zubehördecoder.**

Da für den aktuellen Zustand nur fünf Bits zur Verfügung stehen, wird bei erweiterten Zubehördecodern der Status in zwei Datagrammen übertragen. Die beiden Datagramme sollten gemeinsam im Kanal übertragen werden. Wird nur das Datagramm für die Bits 4 bis 0 des aktuellen Zustands übertragen, so sind die Bits 7 bis 5 als 0 anzunehmen.

**Datagramme für erweiterte Zubehördecoder:**

| Bit | Bedeutung |
|---|---|
| 11 ... 8 | Identifier 0x4 |
| 7 = 0 | |
| 6 | 0: Ausgangszustand stimmt nicht mit dem letzten empfangenen Befehl überein. 1: Ausgangszustand stimmt mit dem letzten empfangenen Befehl überein. |
| 5 | 0: der zurückgemeldete Zustand ist der Sollwert, 1: der zurückgemeldete Zustand ist der Istwert anhand echter Rückmeldung |
| 4 ... 0 | Bit 4 … 0 des aktuellen Zustands |
| 7 = 1 | |
| 6…3 | reserviert |
| 2…1 | Bit 7 … 5 des aktuellen Zustands |

**Tabelle 16: Statusmeldungen für erweiterte Zubehördecoder.**

### 6.4 STAT4 (ID 3)

Diese Rückmeldung dient der Übertragung des Status aller vier Ausgangspaare von Einfachen Zubehördecodern.

**Betriebsbefehls-Antwort: STAT4**
► `10AA-AAAA 1AAA-DAAR` oder `10AA-AAAA 0AAA-0AA1`
◄ Kanal 2 12 Bit: `0100 (ID 3) DDDD-DDDD`

Der Status kann nach Zubehördecoderbefehlen als Quittung zurückgesendet werden. Auf ein "ACK" kann dann verzichtet werden. Die Antwort enthält die Rückmeldungen für jeden der 8 Ausgänge, wobei eine 1 bedeutet, dass der Rückmeldekontakt geschlossen ist bzw. die Endlage erreicht wurde. Die Zuordnung der Ausgänge zu den Bits im Übertragenen Byte ist wie folgt.

| Ausgangspaar | 4 | 3 | 2 | 1 |
|---|---|---|---|---|
| R-Bit im Befehl | `0 (R)` `1 (G)` | `0 (R)` `1 (G)` | `0 (R)` `1 (G)` | `0 (R)` `1 (G)` |
| Bit im RailCom Byte | 7 6 | 5 4 | 3 2 | 1 0 |

**Tabelle 17: Zubehördecoder-Statusbyte**

Gemäß [RCN-213] bedeutet im Befehl für Einfache Zubehördecoder R = 0 Weiche auf Abzweig oder Fahrtrichtung links bzw. Signal auf Halt (klassisch die rote Taste) und R = 1 Weiche gerade oder Fahrtrichtung rechts bzw. Signal auf Fahrt (klassisch die grüne Taste).

Der Aufbau dieses Bytes entspricht dem Inhalt der CV 33 in Zubehördecodern. Diese CV kann von Zentralen per POM (Abschnitt 6.2.1) gelesen werden, um den Status der Ausgänge des Decoders abzufragen.

### 6.5 ZEIT (ID 5)

Diese Rückmeldung dient der Übertragung der prognostizierten Umlaufzeit

**Betriebsbefehls-Antwort: ZEIT**
► `10AA-AAAA 1AAA-DAAR` oder `10AA-AAAA 0AAA-0AA1`
◄ Kanal 2 12Bit: `0101 (ID 5) DDDD-DDDD`

Diese Befehlsbestätigung kann nach Zubehördecoderbefehlen als Quittung zurückgesendet werden. Auf ein "ACK" kann dann verzichtet werden.

Die 7 niederwertigen Bits der Restlaufzeit kennzeichnen die Laufzeit bis zum Erreichen des Ende-Zustands dieses Begriffes (prognostizierte Umlaufzeit). Die Zeit wird abhängig vom MSB in 1/10 Sekunden (MSB = 0) oder 1 Sekunde (MSB = 1) angegeben. Eine Zeit von 0 bedeutet keine Schaltzeit - z.B. bei Signaldecodern ohne Glühlampensimulation. Damit ergibt sich ein Wertebereich 0 ... 12,7 Sekunden bzw. 0 ... 127 Sekunden.

**1. Datagramm**

| Bit | Bedeutung |
|---|---|
| 11 ... 8 | Identifier 0x5 |
| 7 | 0: Auflösung 1/10 Sekunde, 1: Auflösung 1 Sekunde |
| 6 ... 0 | Prognostizierte Umlaufzeit |

**Tabelle 18: prognostizierte Umlaufzeit**

### 6.6 FEHLER (ID 6)

Diese Rückmeldung dient der Übertragung von Fehlerinformationen

**Betriebsbefehls-Antwort: FEHLER**
► Betriebsbefehl an Decoderadresse entsprechend [RCN-213] Abschnitt 2 (einschließlich NOP)
◄ Kanal 2 12Bit: `0110 (ID 6) DDDD-DDDD`

Der Fehlercode kann nach jedem Befehl, welcher den Decoder adressiert, zurückgesendet werden, einschließlich NOP. Auf ein "ACK" kann dann verzichtet werden.

Die Fehlermeldungsübertragung wird durch einen erneuten Schaltbefehl gelöscht. Liegt ein permanenter Fehler vor, darf der Decoder keinen neuen SRQ auslösen, solange derselbe Fehler vorliegt. Die Zentrale muss deshalb nach der Löschung den Decoder erneut ansprechen um festzustellen, ob es sich um einen permanenten Fehler handelt.

| Bit | Bedeutung |
|---|---|
| 11 ... 8 | Identifier 0x6 |
| 7 | reserviert |
| 6 | 0: Es liegt nur der in den folgenden 6 Bits angegebene Fehler vor. 1: Es liegen neben dem angegebenen noch weitere Fehler vor. |
| 5 ... 0 | Fehlercode Bedeutung |
| | 0x00 Kein Fehler (mehr) |
| | 0x01 Befehl konnte nicht ausgeführt werden, unbekannter Befehl / ungültiger Aspect. |
| | 0x02 Stromaufnahme des Antriebs zu hoch. |
| | 0x03 Versorgungsspannung zu gering, die Funktion ist nicht sichergestellt. |
| | 0x04 Sicherung defekt. |
| | 0x05 Temperatur zu hoch. |
| | 0x06 Rückmeldefehler (ungewollte Verstellung festgestellt) |
| | 0x07 Handverstellung (z.B. per Taster am Decoder) |
| | 0x10 Weichenlaterne oder Signallaterne defekt |
| | 0x20 Servo defekt. |
| | 0x3F Interner Decoderfehler, z.B. Selbsttest Prozessor Prüfsumme fehlerhaft. |

**Tabelle 19: Fehlermeldungen**

### 6.7 DYN (ID 7)

Diese Rückmeldung dient der Übertragung dynamischer Informationen von Zubehördecodern Unter "Dynamischen Informationen" werden CV-Inhalte (RailCom-CVs) verstanden, die sich während des Betriebes ändern.

**Betriebsbefehls-Antwort: DYN**
► `10AA-AAAA 1AAA-DAAR` oder `10AA-AAAA 0AAA-0AA1`
◄ Kanal 2 18Bit+[18Bit]: `0111 (ID 7) DDDD-DDDD-XXXX-XX` [`0111 (ID 7) DDDD-DDDD-XXXX-XX`]

Die Übertragung von dynamischen Variablen (DV) erfolgt in einem 18 Bit Datagramm (ID 7), welches den 8 Bit Wert der DV (D) sowie einen 6 Bit Subindex (X) enthält, der eine von 64 möglichen DVs selektiert. Die Bedeutung der DV ist durch den Subindex festgelegt. Zwei beliebige DVs können in einem Rückmeldeframe übertragen werden. Welche DVs ein Decoder wann sendet, bestimmt er selbst.

| X | Bedeutung |
|---|---|
| 0 | Flag Register, Inhalte noch festzulegen |
| 1-2 | Reserviert |
| 3 | RailCom Version als 2x 4 Bit "Hauptversion Nebenversion", 0x15 = Version 1.5 |
| 4 | Änderungs-Flags (Changeflags aus RCN-218) |
| 5 | Flag Register, Inhalte noch festzulegen |
| 6 | Input Register, Belegung noch festzulegen |
| 7 | Empfangsstatistik: Der Zubehördecoder führt eine Statistik über alle empfangenen DCC-Pakete und übermittelt die Zahl fehlerhafter Pakete / Gesamtzahl in %. (Wertebereich 0-100). |
| 8-19 | Inhalt des Behälters 1-12 in % (Wertebereich 0-100) |
| 20 | reserviert |
| 21 | Warn- und Alarmmeldungen ⁶ |
| 22-63 | reserviert |

**Tabelle 20: Dynamische Informationen**

⁶) Die Status- und Alarmmeldungen in DV 21 sind folgendermaßen festgelegt:
Bit 7 = 0: Warnung, Bit 7 = 1 Alarm.
Bit 6 = 0: Warnungen bzw. Alarme unabhängig von anderen DVs entsprechend Tabelle 21. Alle dort nicht aufgeführten Werte sind reserviert.
Bit 6 = 1: Warnungen bzw. Alarme bezogen auf die DVs 0 bis 63. Die DV-Nummer steht in den Bits 0 bis 5.

| Wert | Bedeutung |
|---|---|
| 128 | Alarm Kurzschluss Schaltausgang 1 |
| 129 | Alarm Kurzschluss Schaltausgang 2 |
| 130 | Alarm Kurzschluss Schaltausgang 3 |
| 131 | Alarm Kurzschluss Schaltausgang 4 |
| 132 | Alarm Kurzschluss Schaltausgang 5 |
| 133 | Alarm Kurzschluss Schaltausgang 6 |
| 134 | Alarm Kurzschluss Schaltausgang 7 |
| 135 | Alarm Kurzschluss Schaltausgang 8 |
| 136 | Alarm Übertemperatur |

**Tabelle 21: Warnungen und Alarme unabhängig von DVs**

### 6.8 XPOM (ID 8 bis ID 11)

POM bedeutet "Programming On the Main", also die Programmierung auf dem Gleis zum Fahren. XPOM ist ein gegenüber dem im Abschnitt 6.2 definierten POM erweitertes Format zum Schreiben und Lesen von bis zu vier CVs im Betriebsmodus entsprechend [RCN-214] Abschnitt 4. Auf diese Befehle wird im Kanal 2 mit einem 36 Bit Datagramm mit der ID 8 = 1000 bis ID 11 = 1011 und 32 Datenbits geantwortet. Die Datenbits enthalten den Wert von vier aufeinanderfolgenden CVs.

**Betriebsbefehl: XPOM**
► `1110-KKSS VVVV-VVVV VVVV-VVVV VVVV-VVVV {DDDD-DDDD {DDDD-DDDD {DDDD-DDDD {DDDD-DDDD}}}}`
◄ Kanal 2 (36 Bit): `10SS (ID 8 - 11) DDDD-DDDD DDDD-DDDD DDDD-DDDD DDDD-DDDD` mit D = CV-Daten

Es werden unabhängig von der Anzahl der geschriebenen Bytes und auch beim Schreiben nur eines Bits immer die Werte von vier CVs zurückgemeldet.

Die Zuordnung zwischen Befehl und Antwort erfolgt mittels Sequenznummer SS und Datagramm-ID wie folgt:
- SS = 00 – ID 8 1000
- SS = 01 – ID 9 1001
- SS = 10 – ID 10 1010
- SS = 11 – ID 11 1011

Das zum XPOM-Befehl zugehörige Antwort-Datagramm (ID 8 ... ID 11) muss nicht im selben Paketframe gesendet werden, sondern kann zu einem späteren Zeitpunkt erfolgen.

Der Decoder muss eine Warteschlange für 4 XPOM-Befehle implementieren und diese der Reihe nach abarbeiten. Wiederholt gesendete XPOM-Befehle mit derselben Sequenznummer werden nur einmal in die Warteschlange aufgenommen. Durch das zugeordnete Antwort-Datagramm wird die Operation abgeschlossen und der entsprechende Eintrag in der Warte-schlange wieder freigegeben. Beim Schreiben per XPOM erfolgt die Antwort erst nach dem eigentlichen Schreibvorgang. Auf diese Weise kann die Zentrale auf die Schreibgeschwindig-keit des Decoders synchronisieren. Bei ausbleibendem Antwort-Datagramm muss der letzte Befehl mit derselben Sequenznummer wiederholt gesendet werden. Beim Schreiben von nur lesbaren CVs liefert der Decoder den aktuellen Wert der CVs. Ob ein Schreibzugriff akzeptiert wurde muss von der Zentrale durch Vergleich von Befehl und Antwort ermittelt werden.

Der Decoder muss insbesondere schnelles, blockweises Lesen unterstützen, d.h. bei aufeinanderfolgenden XPOM Lesebefehlen muss die Antwort des n-ten XPOM Lesebefehls spätestens im Cutout des (n+2)-ten XPOM Lesebefehls gesendet werden. Auf diese Weise ist ein sehr schnelles Lesen möglich.

#### 6.8.1 XPOM Byte Lesen

**Betriebsbefehl: XPOM Byte Lesen**
► `1110-01SS VVVV-VVVV VVVV-VVVV VVVV-VVVV`
◄ Kanal 2 (36 Bit): `10SS (ID 8-11) CV[V+0] CV[V+1] CV[V+2] CV[V+3]`

Zum Zeitpunkt der Rückmeldung ist der vorhergehende Text zu beachten.

#### 6.8.2 Byte Schreiben

**Betriebsbefehl: POM Byte Schreiben**
► `1110-11SS VVVV-VVVV VVVV-VVVV VVVV-VVVV {DDDD-DDDD {DDDD-DDDD {DDDD-DDDD {DDDD-DDDD}}}}`
◄ Kanal 2 (36 Bit): `10SS (ID 8-11) CV[V+0] CV[V+1] CV[V+2] CV[V+3]`

Zum Zeitpunkt der Rückmeldung ist der vorhergehende Text zu beachten. Es werden immer die CV-Werte wie nach dem Schreibvorgang zurückgegeben, auch wenn die Schreiboperation nicht oder aufgrund eines begrenzten Wertebereichs nur teilweise ausgeführt werden konnte.

#### 6.8.3 Bit Schreiben

**Betriebsbefehl: XPOM Bit Schreiben**
► `1110-10SS VVVV-VVVV VVVV-VVVV VVVV-VVVV 1111-DBBB`
◄ Kanal 2 (36 Bit): `10SS (ID 8-11) CV[V+0] CV[V+1] CV[V+2] CV[V+3]`

Antworten wie bei "Byte Schreiben". Der Befehl Bit lesen ist für RailCom uninteressant, da immer das ganze Byte zurückgemeldet wird.

### 6.9 STAT2 (ID 8)

Dient nicht für neue Designs, wird aber von auf dem Markt befindlichen Komponenten schon benutzt. Bei anderer Nutzung der ID 8 wird die Länge des Datagrams als Unterscheidungsmerkmal verwendet.

Diese Rückmeldung dient der Übertragung von Statusnachrichten von Zubehördecodern Teil 2 Speziell zugeschnitten für mechanische Stellvorgänge.

**Betriebsbefehls-Antwort: STAT2**
► `10AA-AAAA 1AAA-DAAR` oder `10AA-AAAA 0AAA-0AA1`
◄ Kanal 2 12Bit: `1000 (ID 8) DDDD-DDDD` mit D = Daten entsprechend Tabelle 22, Bits 7 … 0

**1. Datagramm**

| Bit | Bedeutung |
|---|---|
| 11 ... 8 | Identifier 0x8 |
| 7 ... 4 | Konfiguration, bisher festgelegt: 0000 — Entkuppler, 0001 — Weiche, 0010 — Dreiwegweiche, 0011 — Doppel-Kreuzungsweiche, 1000 — Gleissperrsignal, 1001 — Formsignal Hp0/Hp1, 1010 — Formsignal Hp0/Hp1/Hp2, 1011 — Vorsignal Vr0/Vr1, 1100 — Vorsignal Vr0/Vr1/Vr2, 1101 — Bahnschranke |
| 3 | 0: Der in den Bits 2 … 0 gemeldete Zustand entspricht dem Sollwert, bzw. "Stellvorgang dauert noch an". 1: Der gemeldete Zustand entspricht dem Istwert anhand echter Rückmeldung. |
| 2 ... 0 | Aktueller Zustand |

**Tabelle 22: Statusmeldungen, Teil 2**

---

## Anhang A: Verweise auf andere Normen

### A.1 Normative Verweise

- [RCN-210] RCN-210 DCC Paketstruktur
- [RCN-211] RCN-211 DCC Paketstruktur, Adressbereiche und globale Befehle
- [RCN-212] RCN-212 DCC Betriebsbefehle für Fahrzeugdecoder
- [RCN-213] RCN-213 DCC Betriebsbefehle für Zubehördecoder
- [RCN-214] RCN-214 DCC Konfigurationsbefehle

### A.2 Informative Verweise

Die hier aufgeführten Normen und Dokumente haben rein informativen Charakter und sind nicht Bestandteil dieser Norm.

- [RCN-225] RCN-225 DCC Konfigurationsvariablen
- [RCN-218] RCN-218 DCC Automatische Anmeldung
- [TN-217] TN-217 Dateiübertragung per RailCom³
- [S-9.2.1.1] NMRA: S-9.2.1.1 Advanced Extended Packet Formats
- [S-9.2.2 Anhang A] NMRA: S-9.2.2 Appendix A DCC Manufacturer ID codes

---

## Anhang B: Historie

| Datum | Kapitel | Änderungen gegenüber der vorhergehenden Version | Version |
|---|---|---|---|
| 27.07.2025 | 5.2, 5.2.3, 5.2.4, 5.5 | Hinweis für lange Mehrfachtraktionsadressen ergänzt; Konkretisierungen und Festlegungen für die Aufgleissuche; Decoderanmeldung über die Programmieradresse 0000 (statt 0003) ergänzt; Last und Geschwindigkeit bei ID 7 DYN ergänzt. | 1.5 |
| 21.07.2024 | 2.2, 3.1, 4.2.1, 5.2.2, 5.5, 6.4 | Festlegung der Polarität der Einspeisung als Empfehlung; Hinweis zum Senden im Kanal 1 nach jedem Paket; Ergänzung der ID 3 Info1 im Kanal 1; IDs 15 & 15 von RailComPlus genutzt; Bit zur Freigabe von ID 3 im Kanal 1 ergänzt; Neuer Abschnitt: Definition der ID 3 Info1 im Kanal 1; Fußnote zur Geschwindigkeitsmeldung überarbeitet mit Verweis auf Byte 145 im RailCom-Block; Definition von West“ und „Ost“ ergänzt; CV 33 für den Status der Ausgänge jetzt genormt | 1.5 |
| 26.11.2023 | 3.1 / 5.7, 3.2 / 6.4, 4.3.1, 5.4, 6.7 | MOB ID 12 jetzt CV-Auto statt ehemals Test Feature ID; app:Stat4 (STAT ID 3)zur Übertragung des Status von vier Ausgangspaaren eines Einfachen Zubehördecoders nur noch ein Byte lang; XF 3 zum Start der CV-Übertragung mit CV-Auto; Erster Entwurf für die Aktuellen Fahrinformationen (ID 4); DVs 3 bis 19 und 21 von den Fahrzeugdecodern für die Zubehördecoder übernommen. | 1.5 |
| 23.07.2023 | 3.1, 3.2 | MOB ID 4 jetzt Aktuelle Fahrinformationen mit 36 Bit; Hinweis bei ID 13 auf zu erstellende TN-217; STAT ID 3 jetzt Stat4 zur Übertragung des Status von vier Ausgangspaaren eines Einfachen Zubehördecoders | 1.5 |
| 12.12.2021 | 5.4, 6.4, 2.4, 3, 3.1, 4.2.4 | Neu: ID 7 DYN Subindex 3 und 4 für RailCom-Version und Änderungs-Flags; Neu: Senden des Status von vier Ausgangspaaren; Ergänzung Empfangsbereit möglichst nach 75 µs; Rückmeldungen im Kanal 1 in Tabelle 4 und im Text; Kanalbündelung für automatische Anmeldung [RCN-218]; Getrennte Tabellen für die Identifier für die beiden Kanäle; Festlegung der Reihenfolge von Datagrammen; Wertebereich Byte 144 0..100 statt 0..255; Anforderung einer Adresszuweisung per [RCN-218]; Ergänzung Alarm Übertemperatur – Subindex 21; Erklärung Richtungszustandsbyte – Subindex 27; Ergänzung gemessene Gleisspannung – Subindex 46; Ergänzung berechneter Anhalteweg – Subindex 47; Erweiterung von STAT1 für Erweiterte Zubehördecoder | 1.4 |
| 01.12.2019 | 3.1 / 3.2, 5.2.2, 5.4 | Befehlsbezug in den Tabellen 6 und 7; Dauer der Unterbrechung festgelegt; DV 27 als Richtungszustandsbyte definiert | 1.3 |
| 11.08.2019 | 5.2.2, 5.4, 6.7 | Zeit der Aufgleissuche verwendet ID 14 statt ID 0; DVs 21, 23 und 26 näher spezifiziert; XPOM auch in diesem Kapitel vollständig erklärt. | 1.2 |
| 02.12.2018 | 4.3 bis 6.8, 1.1 & 1.2, 2.2, 2.5, 3, 3.1 & 3.2, 4.2.1, 5.1.2, 5.2.1, 5.2.2, 5.3.1, 5.4, 5.5 & 6.7 | Grundlegende Überarbeitung mit DCC-Paketdefinitionen nur noch informativ und Verweisen auf die entsprechende RCN; Abschnitte 1.1 und 1.2 entsprechend angepasst; Neu: Hochstrom RailCom; Rückmeldung NACK; Alle möglichen Datagramm-Kombinationen zulässig; Lange Adresse 3 statt 253 als Programmieraddresse; Abschnitte 3.1 und 3.2 Liste der IDs überarbeitet; CV 28 entsprechend anderer Änderungen angepasst; Antwort beim Byte Schreiben näher spezifiziert; Neu: Dynamische Kanal 1 Nutzung; Neu: Aufgleissuche; Senden der Ortsinformation: Buchstabe P statt O; Weitere DV definiert; Neu: XPOM | 1.1 |
| 18.12.2016 | Alle | Erste Version basierend auf Spezifikation RailCom V 1.4 vom April 2015 der Fa. Lenz | 1.0 |

---

*Copyright 2025 RailCommunity – Verband der Hersteller Digitaler Modellbahnprodukte e.V.*
